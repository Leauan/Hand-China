<?xml version="1.0" encoding="UTF-8"?>
<a:screen xmlns:c="aurora.application.action" xmlns:a="http://www.aurora-framework.org/application" xmlns:p="uncertain.proc" trace="true">
    <a:init-procedure>
        <a:model-query defaultWhereClause="t1.instance_id=${/parameter/@instance_id}" fetchAll="true" model="zjwfl.ZJWFL1060.zj_wfl_approve_history_v" rootPath="approve_history_list"/>
    </a:init-procedure>
    <a:view>
        <a:link id="prj_attach_downloadfile_link1" url="${/request/@context_path}/downloadFile.screen"/>
        <!-- <a:link id="check_agent_link" model="zjwfl.ZJWFL1060.zj_wfl_check_agent_re" modelaction="update"/> -->
        <style><![CDATA[
    		.cell_n{
    		    word-wrap : break-word;
    		    word-break: break-all; 
    		    overflow:hidden; 
    		}
    	]]></style>
        <a:screen-include screen="modules/zjwfl/zj_wfl_common_javascript.screen"/>
        <script><![CDATA[
            function render_action_type_desc(value, record, name) {
                return f_zjwfl.getApproveImg(record.get('record_type'), value);
            }
            
            function open_downloadfile_win(rcpt_record_id) {
                new Aurora.Window({
                    id: 'zj_wfl_approve_history_downloadfile_win',
                    url: $('prj_attach_downloadfile_link1').getUrl() + '?table_name=ZJ_WFL_INSTANCE_NODE_RECIPIENT&header_id=' + rcpt_record_id,
                    title: '附件查看',
                    width: 850,
                    height: 400
                });
            }
            
            function attachement_renderer(value, record, name) {
                if (record.get('rcpt_record_id')) {
                    if (record.get('attach_count') > 0) {
                        return '<a style="color:red" href="javascript:open_downloadfile_win(' + record.get('rcpt_record_id') + ')">附件查看</a>';
                    }
                    return '<a href="javascript:open_downloadfile_win(' + record.get('rcpt_record_id') + ')">附件查看</a>';
                }
            }
            
            function prj_atm_renderer(value, record, name) {
                if (record.get('rcpt_record_id')) {
                    return '<a href="javascript:open_prj_atm()">附件查看</a>';
                }
            }

        ]]></script>
        <a:dataSets>
            <a:dataSet id="approveHistoryDs1">
                <a:datas dataSource="/model/approve_history_list"/>
            </a:dataSet>
            <a:dataSet id="zjwfl_bp_category_history_ds1">
                <a:datas dataSource="/model/zjwfl_bp_category_history"/>
            </a:dataSet>
        </a:dataSets>
        <a:screenBody>
            <a:form marginWidth="30" padding="0">
                <a:table id="zj_wfl_approve_history_table_id1" bindTarget="approveHistoryDs1" canWheel="false" className="cell_n" percentWidth="100">
                    <a:columns>
                        <a:column name="create_date_fmt" prompt="审批时间" width="150"/>
                        <a:column name="action_type_desc" prompt="审批操作" renderer="render_action_type_desc" width="200"/>
                        <!-- <a:column name="comment_text" prompt="内部信审意见" width="250"/> -->
                        <a:column name="comment_text_out" prompt="审批意见" width="400"/>
                        <a:column name="node_desc" prompt="审批节点" width="200"/>
                        <a:column name="approver" prompt="审批人" width="200"/>
                        <a:placeHolder id="dynamicLineColumn_id"/>
                        <a:column name="attachement" align="center" prompt="附件查看" renderer="attachement_renderer" width="80"/>
                    </a:columns>
                </a:table>
            </a:form>
        </a:screenBody>
    </a:view>
    <a:view-config>
        <c:create-config targetId="dynamicLineColumn_id">
            <p:loop source="/model/is_prj_workflow">
                <p:switch test="@prj_workflow">
                    <p:case value="Y">
                        <c:process-config>
                            <a:column name="attachement" align="center" prompt="附件查看" renderer="attachement_renderer" width="80"/>
                        </c:process-config>
                    </p:case>
                </p:switch>
            </p:loop>
        </c:create-config>
    </a:view-config>
</a:screen>
