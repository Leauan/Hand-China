<?xml version="1.0" encoding="UTF-8"?>
<a:screen xmlns:a="http://www.aurora-framework.org/application" customizationEnabled="true" dynamiccreateenabled="true" trace="true">
    <a:view>
        <a:link id="con_contract_get_layout_code_link_id" model="cont.CON500.con_contract_get_layout_code" modelaction="update"/>
        <a:link id="con_contract_move_cars_detail_link" url="${/request/@context_path}/modules/cont/CON651/con_contract_move_cars_detail.screen"/>
        <a:link id="con_df_permission_check_link_id" model="cont.CON651.con_move_cars_submit_wfl" modelaction="update"/>
        <script><![CDATA[

        window['${/parameter/@bp_seq}${/parameter/@layout_code}_on_layout_dynamic_form_add_and_load'] = function(ds, record, config_records, bp_seq) {
            Aurora.Masker.mask(Ext.getBody());
            Aurora.request({
                url: $('con_df_permission_check_link_id').getUrl(),

                success: function(res) {
                    Aurora.Masker.unmask(Ext.getBody());
                    //$('${/parameter/@winid}').close();
                },
                failure: function() {
                    Aurora.Masker.unmask(Ext.getBody());
                },
                error: function() {
                    Aurora.Masker.unmask(Ext.getBody());
                },
                scope: this
            });
        };
        function open_hd_number_Window(record_id, ds_id) {
            var record = $(ds_id).findById(record_id);
            var param = record.data;
            var status = record.get('status');
            if (status == 'NEW' || status == 'REJECT') {
                param['function_code'] = 'CON651D';
                param['function_usage'] = 'MODIFY';
            } else {
                param['function_code'] = 'CON651N';
                param['function_usage'] = 'QUERY';
            }
            param['url_title'] = '车辆移库申请维护';
            param['winid'] = 'con_move_cars_detail_win_id';
            param['document_type'] = 'MOVE_CARS';
            hls_doc_get_layout_code('con_contract_get_layout_code_link_id', param, 'con_contract_move_cars_detail_link', ds_id);
        }
        window['${/parameter/@layout_code}_dynamic_link_renderer'] = function(value, record, name, config_record) {
            if (name == 'hd_number' && value) {
                return '<a href="javascript:open_hd_number_Window(\'' + record.id + '\',\'' + record.ds.id + '\')">' + value + '</a>';
            }
            return value;
        };
       ]]></script>
         <a:screen-include screen="modules/cont/CON500/con_contract_get_layout_code.screen"/>
    </a:view>
</a:screen>
