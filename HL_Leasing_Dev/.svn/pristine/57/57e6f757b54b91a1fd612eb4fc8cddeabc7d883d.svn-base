<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: qm  
    $Date: 2014-4-21 下午2:44:35  
    $Revision: 1.0  
    $Purpose: 
-->
<bm:model xmlns:o="aurora.database.local.oracle" xmlns:f="aurora.database.features" xmlns:bm="http://www.aurora-framework.org/schema/bm" alias="t1" baseTable="AST_CAR_INSURANCE_RECORDS">
    <bm:fields>
        <bm:field name="ast_car_insurance_records_id" databaseType="NUMBER" datatype="java.lang.Long" physicalName="AST_CAR_INSURANCE_RECORDS_ID" prompt="AST_CAR_INSURANCE_RECORDS.AST_CAR_INSURANCE_RECORDS_ID"/>
        <bm:field name="ast_con_car_insurance_id" databaseType="NUMBER" datatype="java.lang.Long" insertExpression="${../../@ast_con_car_insurance_id}" physicalName="AST_CON_CAR_INSURANCE_ID" prompt="AST_CAR_INSURANCE_RECORDS.AST_CON_CAR_INSURANCE_ID"/>
        <bm:field name="record_date" databaseType="DATE" datatype="java.util.Date" physicalName="RECORD_DATE" prompt="AST_CAR_INSURANCE_RECORDS.RECORD_DATE" required="true"/>
        <bm:field name="insurance_type" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="INSURANCE_TYPE" prompt="AST_CAR_INSURANCE_RECORDS.INSURANCE_TYPE"/>
        <bm:field name="record_description" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="RECORD_DESCRIPTION" prompt="AST_CAR_INSURANCE_RECORDS.RECORD_DESCRIPTION"/>
        <bm:field name="settle_claim_amount" databaseType="NUMBER" datatype="java.lang.Double" physicalName="SETTLE_CLAIM_AMOUNT" prompt="AST_CAR_INSURANCE_RECORDS.SETTLE_CLAIM_AMOUNT"/>
        <bm:field name="report_number" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="REPORT_NUMBER" prompt="AST_CAR_INSURANCE_RECORDS.REPORT_NUMBER"/>
        <bm:field name="damage_serious_flag" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="DAMAGE_SERIOUS_FLAG" prompt="AST_CAR_INSURANCE_RECORDS.DAMAGE_SERIOUS_FLAG"/>
        <bm:field name="damage_level_description" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="DAMAGE_LEVEL_DESCRIPTION" prompt="AST_CAR_INSURANCE_RECORDS.DAMAGE_LEVEL_DESCRIPTION"/>
        <bm:field name="document_status" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="DOCUMENT_STATUS" prompt="AST_CAR_INSURANCE_RECORDS.DOCUMENT_STATUS"/>
        <bm:field name="document_status_n" databaseType="VARCHAR2" datatype="java.lang.String" expression="(select v.code_value_name from sys_code_values_v v where v.code=&apos;AST_INSURANCE_DOCUMENT_STATUS&apos; and t1.document_status=v.code_value)" forInsert="false"/>
        <bm:field name="document_type" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="DOCUMENT_TYPE" prompt="AST_CAR_INSURANCE_RECORDS.DOCUMENT_TYPE"/>
        <bm:field name="document_category" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="DOCUMENT_CATEGORY" prompt="AST_CAR_INSURANCE_RECORDS.DOCUMENT_CATEGORY"/>
        <bm:field name="wfl_instance_id" databaseType="NUMBER" datatype="java.lang.Long" physicalName="WFL_INSTANCE_ID" prompt="AST_CAR_INSURANCE_RECORDS.WFL_INSTANCE_ID"/>
        <bm:field name="payment_finish_flag" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="PAYMENT_FINISH_FLAG" prompt="AST_CAR_INSURANCE_RECORDS.PAYMENT_FINISH_FLAG"/>
        <bm:field name="store_person" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="STORE_PERSON" prompt="AST_CAR_INSURANCE_RECORDS.STORE_PERSON"/>
        <bm:field name="store_person_tel" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="STORE_PERSON_TEL" prompt="AST_CAR_INSURANCE_RECORDS.STORE_PERSON_TEL"/>
        <bm:field name="ins_person" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="INS_PERSON" prompt="AST_CAR_INSURANCE_RECORDS.INS_PERSON"/>
        <bm:field name="ins_person_tel" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="INS_PERSON_TEL" prompt="AST_CAR_INSURANCE_RECORDS.INS_PERSON_TEL"/>
        <bm:field name="insurance_number" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="INSURANCE_NUMBER" prompt="AST_CAR_INSURANCE_RECORDS.INSURANCE_NUMBER"/>
        <bm:field name="insurance_company" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="INSURANCE_COMPANY" prompt="AST_CAR_INSURANCE_RECORDS.INSURANCE_COMPANY"/>
        <bm:field name="insurance_company_n" databaseType="VARCHAR2" datatype="java.lang.String" expression="(SELECT v.code_value_name value_name  FROM sys_code_values_v v  WHERE v.code = &apos;INSURANCE_COMPANY&apos;  AND v.code_enabled_flag = &apos;Y&apos; AND v.code_value_enabled_flag = &apos;Y&apos; and v.code_value=t1.insurance_company)"/>
        <bm:field name="material_option" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="MATERIAL_OPTION" prompt="AST_CAR_INSURANCE_RECORDS.MATERIAL_OPTION"/>
        <bm:field name="material_option_n" databaseType="VARCHAR2" datatype="java.lang.String" expression="(SELECT v.code_value_name value_name  FROM sys_code_values_v v  WHERE v.code = &apos;MATERIAL_OPTION&apos;  AND v.code_enabled_flag = &apos;Y&apos; AND v.code_value_enabled_flag = &apos;Y&apos; and v.code_value=t1.material_option)"/>
        <bm:field name="mailmax" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="MAILMAX" prompt="AST_CAR_INSURANCE_RECORDS.MAILMAX"/>
        <bm:field name="mailling_address" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="MAILLING_ADDRESS" prompt="AST_CAR_INSURANCE_RECORDS.MAILLING_ADDRESS"/>
    </bm:fields>
    <bm:features>
        <f:standard-who/>
        <o:sequence-pk sequenceName="AST_CAR_INSURANCE_RECORDS_S"/>
    </bm:features>
    <bm:operations>
        <bm:operation name="insert">
            <bm:update-sql><![CDATA[
                DECLARE
                    v_con_contract con_contract%rowtype;
                    v_ast_car_insurance_records_id number;
                BEGIN
                    INSERT
                    INTO
                        AST_CAR_INSURANCE_RECORDS
                        (
                            AST_CAR_INSURANCE_RECORDS_ID,
                            ast_con_car_insurance_id,
                            RECORD_DATE,
                            INSURANCE_TYPE,
                            RECORD_DESCRIPTION,
                            SETTLE_CLAIM_AMOUNT,
                            REPORT_NUMBER,
                            DAMAGE_SERIOUS_FLAG,
                            DAMAGE_LEVEL_DESCRIPTION,
                            DOCUMENT_STATUS,
                            PAYMENT_FINISH_FLAG,
                            store_person,
                            store_person_tel,
                            ins_person,
                            ins_person_tel,
                            insurance_number,
                            insurance_company,
                            document_type,
                            document_category,
                            wfl_instance_id,
                            material_option,
                            mailmax,
                            mailling_address,
                            CREATED_BY,
                            CREATION_DATE,
                            LAST_UPDATED_BY,
                            LAST_UPDATE_DATE
                        )
                        VALUES
                        (
                            AST_CAR_INSURANCE_RECORDS_S.NEXTVAL,
                            ${../../@ast_con_car_insurance_id},
                            to_date(${@record_date},'yyyy-mm-dd'),
                            ${@insurance_type},
                            ${@record_description},
                            ${@settle_claim_amount},
                            ${@report_number},
                            ${@damage_serious_flag},
                            ${@damage_level_description},
                            ${@document_status},
                            ${@payment_finish_flag},
                            ${@store_person},
                            ${@store_person_tel},
                            ${@ins_person},
                            ${@ins_person_tel},
                            ${@insurance_number},
                            ${@insurance_company},
                            ${@document_type},
                            ${@document_category},
                            ${@wfl_instance_id},
                            ${@material_option},
                            ${@mailmax},
                            ${@mailling_address},
                            ${/session/@user_id},
                            sysdate,
                            ${/session/@user_id},
                            sysdate
                        )
                        RETURNING AST_CAR_INSURANCE_RECORDS_ID
                    INTO
                        v_ast_car_insurance_records_id;
                   select v_ast_car_insurance_records_id into ${@ast_car_insurance_records_id} from dual;
                   ast_insurance_wfl_pkg.check_ln_status(
                   	p_ast_car_insurance_records_id =>v_ast_car_insurance_records_id,
                    p_user_id                      =>${/session/@user_id}
                   );
                END;
            ]]></bm:update-sql>
            <bm:parameters>
                <bm:parameter name="ast_car_insurance_records_id" input="false" output="true" outputPath="@ast_car_insurance_records_id"/>
            </bm:parameters>
        </bm:operation>
        <bm:operation name="update">
            <bm:update-sql><![CDATA[
                BEGIN
                    ast_insurance_wfl_pkg.check_ln_status( p_ast_car_insurance_records_id =>${@ast_car_insurance_records_id}, p_user_id =>${/session/@user_id} );
                    UPDATE
                        AST_CAR_INSURANCE_RECORDS t1
                    SET
                        t1.record_date             =to_date(${@record_date},'yyyy-mm-dd'),
                        t1.insurance_type          =${@insurance_type},
                        t1.record_description      =${@record_description},
                        t1.settle_claim_amount     =${@settle_claim_amount},
                        t1.report_number           =${@report_number},
                        t1.damage_serious_flag     =${@damage_serious_flag},
                        t1.damage_level_description=${@damage_level_description},
                        t1.document_status         =${@document_status},
                        t1.document_type           =${@document_type},
                        t1.document_category       =${@document_category},
                        t1.wfl_instance_id         =${@wfl_instance_id},
                        t1.payment_finish_flag     =${@payment_finish_flag},
                        t1.store_person            =${@store_person},
                        t1.store_person_tel        =${@store_person_tel},
                        t1.ins_person              =${@ins_person},
                        t1.ins_person_tel          =${@ins_person_tel},
                        t1.insurance_number        =${@insurance_number},
                        t1.insurance_company       =${@insurance_company},
                        t1.material_option          =${@material_option},
                        t1.mailmax                  =${@mailmax},
                        t1.mailling_address         =${@mailling_address},
                        t1.LAST_UPDATED_BY          =${/session/@user_id},
                        t1.LAST_UPDATE_DATE         =sysdate
                    WHERE
                        t1.ast_car_insurance_records_id = ${@ast_car_insurance_records_id};
                END;
            ]]></bm:update-sql>
        </bm:operation>
        <bm:operation name="delete">
            <bm:update-sql><![CDATA[
            begin
                ast_insurance_wfl_pkg.delete_ast_con_ln(
                	p_ast_car_insurance_records_id =>${@ast_car_insurance_records_id},
                    p_user_id                  =>${/session/@user_id});
		    end;
        	]]></bm:update-sql>
        </bm:operation>
    </bm:operations>
    <bm:primary-key>
        <bm:pk-field name="ast_car_insurance_records_id"/>
    </bm:primary-key>
    <bm:query-fields>
        <bm:query-field field="ast_con_car_insurance_id" queryOperator="="/>
        <bm:query-field field="ast_car_insurance_records_id" queryOperator="="/>
    </bm:query-fields>
</bm:model>
