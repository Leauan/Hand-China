<?xml version="1.0" encoding="UTF-8"?>
<a:screen xmlns:a="http://www.aurora-framework.org/application" xmlns:p="uncertain.proc" trace="true">
    <!-- <a:init-procedure>
        <a:model-query model="zjwfl.ZJWFL5110.zj_wfl_to_do_list_count" rootpath="to_do_list_count"/>
        <a:model-query model="zjwfl.ZJWFL5110.zj_wfl_to_do_title_count" rootPath="to_do_list_count_rp"/>
        <a:model-query model="zjwfl.ZJWFL5110.zj_wfl_to_do_list_others_count" rootpath="other_list_count"/>
    </a:init-procedure> -->
    <a:view>
        <a:link id="get_document_info_link" model="zjwfl.ZJWFL5110.zj_wfl_get_document_info" modelaction="query"/>
        <a:link id="aut_desc_link" url="${/request/@context_path}/modules/aut/AUT110/aut_allocation_desc.screen"/>
        <!-- <a:switch test="/model/to_do_list_count/record/@list_count"> 
            <a:case value="0">
                <div>
                    <img src="${/request/@context_path}/images/home_page/home_page_to_do.jpg" style="margin-left:10px;margin-top:5px;"/>
                </div>
            </a:case>
            <a:case value="*"> -->
        <a:link id="pageLink_zjwfl5110_wfl_approve" url="${/request/@context_path}/modules/zjwfl/ZJWFL5110/zj_wfl_approve.screen"/>
        <script><![CDATA[
            //alert('width:'+Aurora.getViewportWidth()+';height:'+ Aurora.getViewportHeight());
            
            function query_zjwfl5110_toDoDs() {
                $("zjwfl5110_toDoDs").query();
            }
            
            function winOpen_zjwfl5110_wfl_approve(instance_id, node_id, record_id, workflow_id, record_type) {
                var url_type;
                if (record_type == 'NOTICE') {
                    url_type = 'NOTICE';
                } else {
                    url_type = 'DISPLAY';
                }
                var win = new Aurora.Window({
                    id: 'zj_wfl_approve_win',
                    url: $('pageLink_zjwfl5110_wfl_approve').getUrl(),
                    params: {
                        instance_id: instance_id,
                        node_id: node_id,
                        record_id: record_id,
                        workflow_id: workflow_id,
                        record_type: record_type,
                        url_type: url_type
                    },
                    title: '工作流审批',
                    height: 500,
                    width: 860,
                    fullScreen: true
                });
                win.on('close', function() {
                    query_zjwfl5110_toDoDs();
                });
            }
            
            // function render_zjwfl5110_toDoDs_table(value, record, name) {
                // var record_type = record.get('record_type');
                // if (name == 'document_info') {
                    // if (record.get('workflow_code') == 'WFL_PRJ') {
                        // if (record.get('isreturn') > 0) {
                            // //return '<font color="red">'+value+'</font> ';
                            // return value;
                        // } else {
                            // return value;
                        // }
                    // } else {
                        // return value;
                    // }
                // }
            
                // if (name == 'display_image') {
                    // if (record.get('urgent_type') == 'cui') {
                        // return '<img src="${/request/@context_path}/images/zjwfl/zjwfl_cui.gif" alt="unknown" />';
                    // } else {
                        // if (record_type == 'NOTICE') {
                            // return '<img src="${/request/@context_path}/images/zjwfl/zjwfl_tong.gif"  alt="unknown" />';
                        // } else {
                            // return '<img src="${/request/@context_path}/images/zjwfl/zjwfl_dai.gif"  alt="unknown" />';
                        // }
                    // }
                // } else if (name == 'view_detail') {
                    // return '<a style= "text-decoration:underline;" href="javascript:winOpen_zjwfl5110_wfl_approve(' + record.get('instance_id') + ',' + record.get('node_id') + ',' + record.get('record_id') + ',' + record.get('workflow_id') + ',\'' + record_type + '\');">明细</a>';
                // } else if (name == 'workflow_info') {
                    // if (typeof(value) == "undefined" || !value) {
                        // return '';
                    // } else {
                        // return '<a href="javascript:winOpen_zjwfl5110_wfl_approve(' + record.get('instance_id') + ',' + record.get('node_id') + ',' + record.get('record_id') + ',' + record.get('workflow_id') + ',\'' + record_type + '\');">' + value + '</a>';
                    // }
                // }
                // return '';
            // }
            
            
            // function loadFunction(ds) {
                // $('document_num_id').select(0);
                // $('document_num_id').focus();
            // }
            
            // function loadFunction2(ds) {
            // $('zjwfl5110_45days').query;
            // }
            
            function document_info_renderer(value, record, name) {
                if (record.get('workflow_code') == 'WFL_PRJ' && record.get('seq_number') == '30') {
                    Aurora.request({
                        url: $('get_document_info_link').getUrl(),
                        para: {
                            document_info: record.get('document_info')
                        },
                        success: function(res) {
                            debugger;
                            if (res.result.record['isreturn'] > 0) {
                                debugger;
                                return '<font color="red">' + value + '</font> ';
                            } else {
                                debugger;
                                return value;
                            }
                        }
                    });
                }
            }
            //tree展开时，将tree高度加上展开起来的高度
            
            function tree_expand(tree, node) {
                var child_nodes_length = node.childNodes.length;
                if (node.isExpand) {
                    treegrid1_height = treegrid1_height + child_nodes_length * 25;
                }
            }
            //tree折叠时，将tree高度剪掉折叠起来的高度
            
            function tree_collapse(tree, node) {
                var child_nodes_length = node.childNodes.length;
                if (!node.isExpand) {
                    treegrid1_height = treegrid1_height - child_nodes_length * 25;
                }
            }
            
            function change_color(value,record,name){
                var return_flag = record.get('return_flag');
                if(name == 'workflow_info'){
	                if(return_flag == 'Y'){
	                	return '<font color="RED">'+value+'</font>';
	                }else{
	                    return value;
	                }
                }
            }
            
            
            
            function allocation_confirm(ds, record, name) {
                //var ds = $('zjwfl5110_toDoDs');
                var win = new Aurora.Window({
                    id: 'aut_allocation_window',
                    url: $('aut_desc_link').getUrl(),
                    params: {
                        winId: 'aut_allocation_window',
                        user_id: ${/parameter/@user_id},
                        company_id: ${/session/@company_id}
                    },
                    title: '分配审批人',
                    height: 480,
                    width: 750
                });
            }
        ]]></script>
        <a:dataSets>
            <a:dataSet id="zj_wfl_document_number_ds" autoCreate="true">
                <a:fields>
                    <a:field name="any_info"/>
                </a:fields>
            </a:dataSet>
            <a:dataSet id="zj_wfl_document_number_ds2" autoCreate="true"><![CDATA[
            	]]></a:dataSet>
            <a:dataSet id="zjwfl5110_toDoDs" autoQuery="true" model="aut.AUT110.zj_wfl_instance_node_recipient" pageSize="200" queryDataSet="zj_wfl_document_number_ds" queryUrl="${/request/@context_path}/autocrud/aut.AUT110.zj_wfl_instance_node_recipient/query?user_id=${/parameter/@user_id}" selectable="true">
                <a:fields>
                    <a:field name="user_id" defaultValue="${/parameter/@user_id}"/>
                    <a:field name="credit_flag" checkedValue="Y" readOnly="true" uncheckedValue="N"/>
                    <a:field name="current_user"/>
                    <a:field name="times"/>
                    <a:field name="return_flag"/>
                </a:fields>
                <!-- <a:events>
                    <a:event name="load" handler="loadFunction"/>
                </a:events> -->
            </a:dataSet>
            <!-- <a:dataSet id="zjwfl5110_45days" autoPageSize="true" autoQuery="true" model="zjwfl.ZJWFL5110.zj_wfl_45days"/> -->
            <a:dataSet id="zj_wfl_untransact_insurance_con_ds" autoPageSize="true" autoQuery="true" model="zjwfl.ZJWFL5110.zj_wfl_untransact_insurance_con"/>
            <a:dataSet id="zj_wfl_con_insurance_continue_notice_ds" autoPageSize="true" autoQuery="true" model="zjwfl.ZJWFL5110.zj_wfl_con_insurance_continue_notice">
                <a:fields>
                    <a:field name="insurance_date_to" datatype="java.util.Date"/>
                </a:fields>
            </a:dataSet>
        </a:dataSets>
        <a:switch test="/model/to_do_list_count/record/@list_count">
            <a:case value="0">
                <div id="top_wfl_to_do" style="margin-left:10px;">
                    <script><![CDATA[
        				document.getElementById('top_wfl_to_do').style.width=''+Number(Aurora.getViewportWidth()-30)+'px';
        			]]></script>
                    <!-- <img src="${/request/@context_path}/images/home_page/home_page_to_do.jpg" style="margin-left:0px;margin-top:5px;"/> -->
                    <a:gridButton click="allocation_confirm" style="margin-left:0px;margin-top:5px;" text="确认分配"/>
                    <div style="float:right;">
                        <table style="margin-right:0px;margin-top:10px;border:0px;padding:0px;border-collapse:collapse;">
                            <tr>
                                <!-- <td style="font-weight:bold;">
                                    <span><![CDATA[您共有]]></span>
                                    <span style="color:red;"><![CDATA[${/model/to_do_list_count/record/@list_count}]]></span>
                                    <span><![CDATA[件待办事项]]></span>
                                </td> -->
                                <!-- <td>
                                    <a:textField name="any_info" id="document_num_id" bindTarget="zj_wfl_document_number_ds" prompt="" width="200">
                                        <a:events>
                                            <a:event name="enterdown" handler="query_zjwfl5110_toDoDs"/>
                                        </a:events>
                                    </a:textField>
                                </td> -->
                                <!-- <td>
                                    <a:button click="query_zjwfl5110_toDoDs" text="查询"/>
                                </td> --><![CDATA[
                                
                                
                                
                                ]]></tr>
                        </table>
                    </div>
                </div>
            </a:case>
            <a:case value="*">
                <div id="top_wfl_to_do" style="margin-left:10px;">
                    <script><![CDATA[
        				document.getElementById('top_wfl_to_do').style.width=''+Number(Aurora.getViewportWidth()-30)+'px';
        			]]></script>
                    <!-- <img src="${/request/@context_path}/images/home_page/home_page_to_do.jpg" style="margin-left:0px;margin-top:5px;"/> -->
                    <a:gridButton click="allocation_confirm" style="margin-left:0px;margin-top:5px;" text="确认分配"/>
                    <div style="float:right;">
                        <table style="margin-right:0px;margin-top:10px;border:0px;padding:0px;border-collapse:collapse;">
                            <tr>
                                <!-- <td style="font-weight:bold;">
                                    <span><![CDATA[您共有]]></span>
                                    <span style="color:red;"><![CDATA[${/model/to_do_list_count/record/@list_count}]]></span>
                                    <span><![CDATA[件待办事项]]></span>
                                </td> -->
                                <!-- <td>
                                    <a:textField name="any_info" id="document_num_id" bindTarget="zj_wfl_document_number_ds" prompt="" width="200">
                                        <a:events>
                                            <a:event name="enterdown" handler="query_zjwfl5110_toDoDs"/>
                                        </a:events>
                                    </a:textField>
                                </td> -->
                                <!-- <td>
                                    <a:button click="query_zjwfl5110_toDoDs" text="查询"/>
                                </td> --><![CDATA[
                                
                                
                                
                                ]]></tr>
                        </table>
                    </div>
                </div>
                <div style="margin-left:10px;">
                    <a:treeGrid id="zjwfl5110_result_tree" bindTarget="zjwfl5110_toDoDs" expandField="expand_flag" idField="child_workflow_desc" marginHeight="120" marginWidth="32" parentField="workflow_desc" sequenceField="creation_date_format" showCheckBox="false">
                        <a:columns>
                            <!-- <a:column name="display_image" align="center" prompt="" renderer="render_zjwfl5110_toDoDs_table"/> -->
                            <a:column name="child_workflow_desc" prompt="工作流" width="60"/>
                            <a:column name="workflow_info" prompt="工作流名称" renderer="change_color" width="250"/>
                            <a:column name="submitted_by_name" prompt="提交人" width="210"/>
                            <a:column name="document_info" prompt="单据信息" width="320"/>
                            <a:column name="times" prompt="期数" width="60"/>
                            <a:column name="down_payment_ratio" prompt="首付比例" width="100"/>
                            <a:column name="current_user" prompt="当前用户" width="100"/>
                            <a:column name="credit_flag" prompt="征信" width="50"/>
                            <!--                            <a:column name="finance_amount" prompt="融资总额" width="130"/>
                            <a:column name="down_payment_ratio" prompt="首付款比例" width="130"/>
                            <a:column name="price_list_n" prompt="产品名称" width="90"/>
                            <a:column name="division" prompt="产品线" width="90"/> -->
                            <a:column name="creation_date_format" prompt="到达时间" width="130"/>
                            <!--                             <a:column name="project_number" prompt="项目编号" width="130"/>
 -->
                            <!-- <a:column name="view_detail" align="center" prompt="明细" renderer="render_zjwfl5110_toDoDs_table"/> -->
                        </a:columns>
                        <a:events>
                            <a:event name="expand" handler="tree_expand"/>
                            <a:event name="collapse" handler="tree_collapse"/>
                        </a:events>
                    </a:treeGrid>
                </div>
                <!--  <a:tabPanel height="400" marginWidth="30">
                        <a:tabs>
                            <a:tab id="contract_warn_tab_id" prompt="" width="150">
                                <a:grid bindTarget="zjwfl5110_45days" height="360" marginWidth="50" navBar="true">
                                    <a:columns>
                                        <a:column name="contract_number" prompt="15天预警合同编号" width="200"/>
                                        <a:column name="bp_id_tenant_n" prompt="承租人" width="400"/>
                                        <a:column name="last_date" prompt="最后日期" renderer="Aurora.formatDate" width="100"/>
                                        <a:column name="days" prompt="天数" width="100"/>
                                    </a:columns>
                                </a:grid>
                            </a:tab>
                        </a:tabs>
                    </a:tabPanel> -->
            </a:case>
        </a:switch>
        <div id="insurance_tabs_id" style="display:none;">
            <a:tabPanel height="400" marginWidth="30">
                <a:tabs>
                    <a:tab id="untransact_insurance_tab_id" prompt="" width="150">
                        <a:grid bindTarget="zj_wfl_untransact_insurance_con_ds" height="360" marginWidth="50" navBar="true">
                            <a:columns>
                                <a:column name="contract_number" prompt="合同编号" width="200"/>
                                <a:column name="bp_name" prompt="承租人" width="400"/>
                                <a:column name="inception_of_lease" prompt="起租日" width="100"/>
                            </a:columns>
                        </a:grid>
                    </a:tab>
                    <a:tab id="insurance_continue_tab_id" prompt="" width="130">
                        <a:grid bindTarget="zj_wfl_con_insurance_continue_notice_ds" height="360" marginWidth="50" navBar="true">
                            <a:columns>
                                <a:column name="contract_number" prompt="合同编号" width="200"/>
                                <a:column name="bp_name" prompt="承租人" width="400"/>
                                <a:column name="insurance_date_to" prompt="保险到期日" renderer="Aurora.formatDate" width="100"/>
                            </a:columns>
                        </a:grid>
                    </a:tab>
                </a:tabs>
            </a:tabPanel>
        </div>
        <!-- <script><![CDATA[
            var to_do_title_count = ${/model/to_do_list_count_rp/record/@title_count};
            var to_do_list_count = ${/model/to_do_list_count/record/@list_count};
            if (to_do_title_count == 1) {
                treegrid1_height = 28 * (to_do_list_count + 3);
            } else {
                treegrid1_height = 28 * (to_do_list_count + 2);
            }
            var screen_width = Aurora.getViewportWidth() - 100;
            
            if (Aurora.CmpManager.get('zjwfl5110_result_tree')) {
                var treegrid = $('zjwfl5110_result_tree');
                treegrid.setColumnSize('child_workflow_desc', Math.round(screen_width * 0.12));
                treegrid.setColumnSize('workflow_info', Math.round(screen_width * 0.15));
                treegrid.setColumnSize('submitted_by_name', Math.round(screen_width * 0.10));
                treegrid.setColumnSize('document_info', Math.round(screen_width * 0.20));
                treegrid.setColumnSize('finance_amount', Math.round(screen_width * 0.15));
                treegrid.setColumnSize('down_payment_ratio', Math.round(screen_width * 0.05));
                treegrid.setColumnSize('price_list_n', Math.round(screen_width * 0.05));
                treegrid.setColumnSize('division', Math.round(screen_width * 0.05));
                treegrid.setColumnSize('creation_date_format', Math.round(screen_width * 0.10));
                treegrid.setColumnSize('view_detail', Math.round(screen_width * 0.065));
            }
        ]]></script> -->
    </a:view>
</a:screen>
