<?xml version="1.0" encoding="UTF-8"?>
<bm:model xmlns:bm="http://www.aurora-framework.org/schema/bm">
    <bm:operations>
        <bm:operation name="update">
            <bm:query-sql><![CDATA[
                 DECLARE
                    v_je_template_hd_id   NUMBER;
                    v_total_amount_fuc_dr NUMBER;
                BEGIN
                    SELECT
                        a.je_template_hd_id
                    INTO
                        v_je_template_hd_id
                    FROM
                        gld_je_template_hds a
                    WHERE
                        a.document_type = ${@document_type} AND
                        rownum          = 1;
                    SELECT
                        SUM(NVL(b.amount_dr, 0))
                    INTO
                        v_total_amount_fuc_dr
                    FROM
                        hls_journal_header a,
                        hls_journal_detail b
                    WHERE
                        a.journal_header_id = b.journal_header_id AND
                        a.journal_num       = ${@journal_num};
                    UPDATE
                        hls_journal_header h
                    SET
                        h.je_template_hd_id   = v_je_template_hd_id,
                        h.document_category   = 'JE',
                        h.total_amount_fuc_dr =v_total_amount_fuc_dr
                    WHERE
                        h.journal_num = ${@journal_num};
                END;
            ]]></bm:query-sql>
        </bm:operation>
    </bm:operations>
</bm:model>
