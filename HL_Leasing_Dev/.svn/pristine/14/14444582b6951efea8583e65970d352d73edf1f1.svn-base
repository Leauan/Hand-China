<?xml version="1.0" encoding="UTF-8"?>
<!--
	&author:DJ
	$date:2013/11/20
	$purpose:项目上会工作流项目信息
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application">
    <a:init-procedure>
        <a:model-query model="wfl_screen.PRJ_PROJECT.prj_project_info" rootPath="prj_doc_project_record"/>
    </a:init-procedure>
    <a:view>
        <a:link id="prj_project_get_layout_code_link_id" model="cont.CON500.con_contract_get_layout_code" modelaction="update"/>
        <a:link id="prj_project_update_link_id" url="${/request/@context_path}/modules/prj/PRJ500/prj_project_create_tree.screen"/>
        <a:link id="prj_project_oppions_link_id" url="${/request/@context_path}/modules/prj/PRJ501/print_test.screen"/>
        <a:link id="prj_project_survey_link_id" url="${/request/@context_path}/modules/prj/PRJ501/print_project_survey.screen"/>
        <a:link id="prj_project_credit_link_id" url="${/request/@context_path}/modules/prj/PRJ501/print_project_credit_check.screen"/>
        <a:link id="prj_project_opinions_vote_link_id" url="${/request/@context_path}/modules/prj/PRJ501/print_project_opinions_vote.screen"/>
        <a:link id="prj_project_approval_sum_link_id" url="${/request/@context_path}/modules/prj/PRJ501/print_project_approval_sum.screen"/>
        <a:screen-include screen="modules/prj/PRJ500/prj_project_get_layout_code.screen"/>
        <script><![CDATA[
            function winOpen_projectDetailInfo() {
                var record = $('prjDoc_projectInfoDs').getAt(0);
                var param = record.data;
                	param['function_code'] = 'PRJ502';
                if ('${/parameter/@show_project_info}' == 'W') {
                    param['function_code'] = 'PRJ501';
                }
                param['document_id'] = '${/parameter/@project_id}';
                param['function_usage'] = 'QUERY_FOR_WORKFLOW';
                	param['maintain_type'] = 'READONLY';
                if ('${/parameter/@show_project_info}' == 'W') {
                    param['maintain_type'] = 'UPDATE';
                }
                param['url_title'] = '项目详细信息';
                hls_doc_get_layout_code('prj_project_get_layout_code_link_id', param, 'prj_project_update_link_id');
            } 
             
            function downloading_application() {
                location.href = $('prj_project_application_link_id').getUrl() + "?project_id=${/parameter/@project_id}";
            }
            
            function downloading_oppions() {
                location.href = $('prj_project_oppions_link_id').getUrl() + "?project_id=${/parameter/@project_id}";
            }
            
            function downloading_survey() {
                location.href = $('prj_project_survey_link_id').getUrl() + "?project_id=${/parameter/@project_id}";
            }
            
            function downloading_credit() {
                location.href = $('prj_project_credit_link_id').getUrl() + "?project_id=${/parameter/@project_id}";
            }
            
            function downloading_opinions_vote() {
                location.href = $('prj_project_opinions_vote_link_id').getUrl() + "?project_id=${/parameter/@project_id}";
            }
            
            function downloading_approval_sum(){
                location.href = $('prj_project_approval_sum_link_id').getUrl() + "?project_id=${/parameter/@project_id}&approval_id=${/parameter/@approval_id}";
            }
        ]]></script>
        <a:dataSets>
            <a:dataSet id="prjDoc_projectInfoDs" model="wfl_screen.PRJ_PROJECT.prj_project_info">
                <a:datas dataSource="/model/prj_doc_project_record"/>
            </a:dataSet>
            <a:dataSet id="ca_culator_hd_ds" autoQuery="true" queryUrl="${/request/@context_path}/autocrud/prj.PRJ501.project_calculator_hd/query?project_id=${/parameter/@project_id}"><![CDATA[
              ]]></a:dataSet>
        </a:dataSets>
        <a:screenBody>
            <a:form title="项目信息" width="1200">
                <a:hBox labelWidth="100">
                    <a:textField name="project_name" bindTarget="prjDoc_projectInfoDs" prompt="项目名称" readOnly="true" width="408"/>
                    <a:textField name="employee_id_n" bindTarget="prjDoc_projectInfoDs" prompt="项目经理" readOnly="true"/>
                    <a:textField name="employee_id_of_manager_n" bindTarget="prjDoc_projectInfoDs" prompt="部门经理" readOnly="true"/>
                </a:hBox>
                <a:hBox labelWidth="100">
                    <a:textField name="project_number" bindTarget="prjDoc_projectInfoDs" prompt="项目编号" readOnly="true"/>
                    <a:numberField name="finance_amount" allowFormat="true" bindTarget="ca_culator_hd_ds" decimalPrecision="2" prompt="融资金额" readOnly="true"/>
                    <a:textField name="currency_n" bindTarget="prjDoc_projectInfoDs" prompt="币种" readOnly="true"/>
                    <a href="javascript:winOpen_projectDetailInfo();" style="margin-left:19px;text-decoration:underline"><![CDATA[项目详细信息]]></a>
                    <a:switch test="/parameter/@show_project_survey_print">
                        <a:case value="Y">
                            <a href="javascript:downloading_survey();" style="margin-left:19px;text-decoration:underline"><![CDATA[项目调查报告]]></a>
                        </a:case>
                    </a:switch>
                    <a:switch test="/parameter/@show_project_view_print">
                        <a:case value="Y">
                            <a href="javascript:downloading_oppions();" style="margin-left:19px;text-decoration:underline"><![CDATA[评审会意见落实表]]></a>
                        </a:case>
                    </a:switch>
                    <a:switch test="/parameter/@show_project_credit_check_print">
                        <a:case value="Y">
                            <a href="javascript:downloading_credit();" style="margin-left:19px;text-decoration:underline"><![CDATA[信审报告]]></a>
                        </a:case>
                    </a:switch>
                    <a:switch test="/parameter/@show_project_opinion_vote_print">
                        <a:case value="Y">
                            <a href="javascript:downloading_opinions_vote();" style="margin-left:19px;text-decoration:underline"><![CDATA[项目评审会委员表决意见表]]></a>
                        </a:case>
                    </a:switch>
                    <a:switch test="/parameter/@show_approver_table_print">
                        <a:case value="Y">
                            <a href="javascript:downloading_approval_sum();" style="margin-left:19px;text-decoration:underline"><![CDATA[评审意见汇总表]]></a>
                        </a:case>
                    </a:switch>
                </a:hBox>
            </a:form>
        </a:screenBody>
    </a:view>
</a:screen>
