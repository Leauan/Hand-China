<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: niujiaqing1265 $
    $Date: 2010/11/18 08:21:59 $
    $Revision: 1.13 $
    $Purpose: 登陆界面
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application" trace="true">
    <a:init-procedure>
        <a:model-query model="sys.sys_user_role_groups" rootPath="role_list"/>
    </a:init-procedure>
    <a:view>
        <a:link id="login_link_2" url="${/request/@context_path}/login.screen"/>
        <a:link id="role_select_link_1" url="${/request/@context_path}/role_select.svc"/>
        <a:link id="loading_link" url="${/request/@context_path}/loading.screen"/>
        <script><![CDATA[
             var canGoToMainService = false;
            function openwin() {
                var aw = window.screen.availWidth; 
                var ah = window.screen.availHeight;
                popsizewin(0,0,aw-10,ah-20,1,1); 
            }
            
            function popsizewin(tleft,ttop,twidth,theight,tscrollbar,tresizable){
                var jsid = Aurora.getCookie('JSID');
                window._mainwin = window.open('loading.screen'/*$('loading_link').getUrl()*/,jsid);
            }
            
            Aurora.Status.enable = false;
            Aurora.SideBar.enable = false;
            function goToMain(){
                var radio = $('roleRadios');
                var record = radio.getItem();
                if(record){
                    openwin();
                    Aurora.request({url:'role_select.svc'/*$('role_select_link_1').getUrl()*/, para:record.data, success:selectRoleSuccess, scope:this});
                }else{
                    Aurora.showWarningMessage('错误', "没有可选角色!");
                }
                
            }
            function afterOpen(){
                canGoToMainService = false;
                window._mainwin.focus();
            }
            
            
            function selectRoleSuccess(){
                canGoToMainService = true;
            }
            
            function backToLogin(){
                window.location.href = 'login.screen'/*$('login_link_2').getUrl()*/;
            }
            
            function optionRenderer(){
            
            }
                ]]></script>
        <a:template package="ui.template" template="roleselectTemplate">
            <a:radio id="roleRadios" labelExpression="${@role_description}_${@company_short_name}" layout="vertical" options="/model/role_list" valueField="role_company" width="230">
                <a:events>
                    <event name="enterdown" handler="goToMain"/>
                </a:events>
            </a:radio>
        </a:template>
        <script><![CDATA[
        
            Aurora.onReady(function(){
                $('roleRadios').select(0);
                /*** add by zhl 0929 多角色显示***/
                var el='roleForm';
				        var ele;
				    if(typeof(el)=="string"){  
				        var cmp = Aurora.CmpManager.get(el)
				        if(cmp){
				            if(cmp.wrap){
				                ele = cmp.wrap;
				            }
				        }else{
				             ele = Ext.get(el);
				        }             
				    }else{
				        ele = Ext.get(el);
				    }
				    var screenWidth = Aurora.getViewportWidth();
				    var screenHeight = Aurora.getViewportHeight();
				    if (ele == null ||ele == 'undefined'){   
						var x = Math.max(0,(screenWidth )/2-500);
						var y = Math.max(0,(screenHeight )/2-200);
				    } else{
						var x = Math.max(0,(screenWidth - ele.getWidth())/2-500);
						var y = Math.max(0,(screenHeight - ele.getHeight())/2-200);	
				    ele.setStyle('position','absolute');
				    ele.moveTo(x,y); 			    
				    }
            })
            
        
        ]]></script>
    </a:view>
</a:screen>
