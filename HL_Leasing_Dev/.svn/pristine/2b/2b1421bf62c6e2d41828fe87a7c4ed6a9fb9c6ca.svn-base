<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: xuls  
    $Date: 2017-1-13 下午2:51:34  
    $Revision: 1.0  
    $Purpose: 
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application" customizationEnabled="true" dynamiccreateenabled="true">
    <a:init-procedure/>
    <a:view>
        <a:link id="csh507_ccb_query_link" model="csh.CSH507.query_ccb_pay" modelaction="execute"/>
        <script><![CDATA[
    window['${/parameter/@layout_code}_user_button1_layout_dynamic_click'] = function() {
	        Aurora.showConfirm('${l:HLS.PROMPT}', '是否发起查询', function() {
	        var detail_mask = Ext.getBody();
	        Aurora.Masker.mask(detail_mask, '${l:HLS.EXECUTING}');
            var hdds_id = get_dsid_by_basetable(window['${/parameter/@layout_code}_layoutDataSetList'], 'hls_ebank_ccb_ptransaction');
            var hd_record = $(hdds_id).getCurrentRecord();
            window['${/parameter/@bp_seq}${/parameter/@layout_code}_lock_layout_dynamic_window']();
            Aurora.request({
                url: $('csh507_ccb_query_link').getUrl(),
                para: {
                    ptransaction_id: hd_record.get('transaction_id')
                },
                success: function() {
                    Aurora.Masker.unmask(detail_mask);
                    $(hdds_id).query();
                },
                error: function() {
                    Aurora.Masker.unmask(detail_mask);
                },
                failure: function() {
                    Aurora.Masker.unmask(detail_mask);
                },
                scope: this
            });
        });
    };
]]></script>
        <a:screen-include screen="modules/cont/CON500/con_contract_get_layout_code.screen"/>
    </a:view>
</a:screen>
