<?xml version="1.0" encoding="UTF-8"?>
<a:service xmlns:ns1="aurora.application.action" xmlns:s="aurora.plugin.script" xmlns:a="http://www.aurora-framework.org/application" xmlns:p="uncertain.proc" trace="true">
    <a:init-procedure>
        <s:server-script import="yonda_itfc_config/kingdee_journal_config.js"><![CDATA[
            function kinddee_itfc() {
                importPackage(Packages.java.io);
                importPackage(Packages.java.util);
                importPackage(Packages._214._64._235._180.ormrpc.services.EASLogin);
                var journal_header_id;
                var EASLogin_address = "http://180.235.64.214:7888/ormrpc/services/EASLogin";
                var proxy = new EASLoginProxyProxy(EASLogin_address);
                var ctx = proxy.login("1396", "1396", "eas", "YD", "l2", 1);
               // BusinessModelService bms = dsf.getModelService("hls_ws.hls_journal_detail_for_kingdie", context);
                 var bms = $bm('hls_ws.hls_journal_detail_for_kingdie')
                 println(ctx.getSessionId());
                 var kinddee_itfc = new KingdeeItfc($instance('aurora.database.service.IDatabaseServiceFactory'), $instance('uncertain.ocm.IObjectRegistry'), $ctx.getData());
                 var children = $ctx.parameter.getChildren();
                 var ret=new Array;
                // println(children.length);
                 for (var i = 0;i < children.length;i++) {
                     journal_header_id = children[i].journal_id;
                   ret= kinddee_itfc.transfer_voucher(journal_header_id);
                   println(ret[0]); 
                   println(ret[1]); 
                   println(ret[2]); 
                   // kingdeeParams.put("kingdee_journal_header_num",
							// ret[0]);
					
					// kingdeeParams.put("interface_deal_message", ret[1]);
					// kingdeeParams.put("itfc_exception", ret[2]);
					// kingdeeParams.put("journal_header_id", journal_header_id);		
                   // bms.executeDml(kingdeeParams, "update");
                   bms.update({
                        kingdee_journal_header_num : ret[0],
                        interface_deal_message: ret[1],
                        journal_header_id: journal_header_id,
                        itfc_exception:ret[2]
                    });
                 }
           
            }
            
            kinddee_itfc();
        ]]></s:server-script>
    </a:init-procedure>
    <a:service-output output="/parameter"/>
</a:service>
