<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: ZLF  
    $Date: 2014-10-20 下午01:54:29  
    $Revision: 1.0  
    $Purpose: 合同维护入口界面
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application" customizationEnabled="true" dynamiccreateenabled="true" trace="true">
    <a:view>
        <a:link id="con_contract_get_layout_code_link_id" model="cont.CON500.con_contract_get_layout_code" modelaction="update"/>
        <a:link id="con_contract_modify_link" url="${/request/@context_path}/modules/cont/CON501P/con_contract_prj_modify.screen"/>
        <a:link id="prj_project_query_link_id" url="${/request/@context_path}/modules/prj/PRJ501N/prj_project_create_tree_n.screen"/>
        <a:link id="car_modify_mananger_link" url="${/request/@context_path}/modules/prj/PRJ501N/prj_project_maintain_manager.screen"/>
        <a:link id="car_modify_link" url="${/request/@context_path}/modules/prj/PRJ501N/prj_project_maintain.screen"/>
        <script><![CDATA[
    	
    	function open_contract_win(record_id,ds_id){
    	    var record=$(ds_id).findById(record_id);
    	    var maintain_type = 'QUERY';
   			 if (record.get('project_document_type') == 'PRJ') {
	    	    var param = record.data;
	    	    	param['document_id'] = record.get('project_id');
	                param['function_code'] = 'PRJ600Q';
	                param['function_usage'] = 'QUERY';
	                param['maintain_type'] = maintain_type;
	                param['url_title'] = '${l:HLS.PROJECT_MAITAIN}';
	            	hls_doc_get_layout_code('con_contract_get_layout_code_link_id', param, 'prj_project_query_link_id',ds_id);
   			 } else if (record.get('project_document_type') == 'CARLS') {
                    if (record.get('lease_channel') == '02') {
                        //管理人员
                        param = record.data;
                        param['document_id'] = record.get('project_id');
                        param['function_code'] = 'PRJ502D';
                        param['function_usage'] = 'QUERY';
                        param['maintain_type'] = maintain_type;
                        param['document_type']=record.get('project_document_type');
                        param['url_title'] = '${l:HLS.PROJECT_MAITAIN}';
                        hls_doc_get_layout_code('con_contract_get_layout_code_link_id', param, 'car_modify_mananger_link', 'projectQueryScreen_mainDs');
                    } else {
                        param = record.data;
                        param['document_id'] = record.get('project_id');
                        param['function_code'] = 'PRJ502D';
                        param['function_usage'] = 'QUERY';
                        param['maintain_type'] = maintain_type;
                        param['document_type']=record.get('project_document_type');
                        param['url_title'] = '${l:HLS.PROJECT_MAITAIN}';
                        hls_doc_get_layout_code('con_contract_get_layout_code_link_id', param, 'car_modify_link', 'projectQueryScreen_mainDs');
                    }
                }
    	}
    
    	//合同维护
    	window['${/parameter/@layout_code}_user_button3_layout_dynamic_click'] = function() {
				var ds_id = get_dsid_by_basetable(window['${/parameter/@layout_code}_layoutDataSetList'], 'con_contract');
				if($(ds_id).getSelected().length != 1) {
				    Aurora.showMessage('提示','请选择一行数据！');
				    return;
				}
				var record = $(ds_id).getSelected()[0];
				var param = record.data;
    	    	param['document_id'] = record.get('contract_id');
                param['function_code'] = 'CON501PRJ';
                param['function_usage'] = 'MODIFY';
                param['maintain_type'] = 'UPDATE';
                param['url_title'] = '${l:CON301.CONTRACT_DETAIL}';
            	hls_doc_get_layout_code('con_contract_get_layout_code_link_id', param, 'con_contract_modify_link',ds_id);		
            };
            
    	//申请编号超链接
		window['${/parameter/@layout_code}_dynamic_link_renderer']=function(value,record,name,config_record){
		  
		    if(name=='project_id_c' && value){
		        return '<a href="javascript:open_contract_win(\''+record.id+'\',\''+record.ds.id+'\')">'+value+'</a>';
		    }
		    return value;
		};
		window['${/parameter/@layout_code}_on_layout_dynamic_grid_query'] = function(ds, qpara, bp_seq) {      
                 var ds_id = get_dsid_by_basetable(window['${/parameter/@layout_code}_layoutDataSetList'], 'con_contract');
                
                 if(ds==$(ds_id)){
                aut_authority_list_validate_query(ds, qpara);
        
                 }
               };
	]]></script>
        <a:screen-include screen="modules/cont/CON500/con_contract_authority_list_validate.screen?document_category=CONTRACT&amp;function_code=CON501"/>
        <a:screen-include screen="modules/cont/CON500/con_contract_get_layout_code.screen"/>
    </a:view>
</a:screen>
