<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author:  LIANGSAISAI
    $Date: 2016-1-20 16:51:37  
    $Revision: 1.0  
    $Purpose: 
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application" customizationEnabled="true" dynamiccreateenabled="true" trace="true">
    <a:view>
        <script><![CDATA[
            window['${/parameter/@bp_seq}${/parameter/@layout_code}_user_button1_layout_dynamic_click'] = function() {
                window.close();
            };
            
            window['${/parameter/@bp_seq}${/parameter/@layout_code}_user_button2_layout_dynamic_click'] = function() {
                $('${/parameter/@layout_code}_RD_RESULT_DAIFU_rd_ebank_spd_txds71_doc_layout_grid_id')._export();
            };
            
            //更新时调用
            window['${/parameter/@bp_seq}${/parameter/@layout_code}_on_layout_dynamic_update'] = function(ds, record, name, value, old_value, bp_seq) {
               //日期
               if (name == 'status_date_from' && !Aurora.isEmpty(value)){
                   record.set('status_date_to', value);
               }
               var status_date_to = record.get('status_date_to');
               var status_date_from = record.get('status_date_from');
               
               if (status_date_from > status_date_to){
                   Aurora.showMessage('${l:HLS.PROMPT}', '开始日期不能大于结束日期');
               }
               
               //批次编号
               if (name == 'transaction_number_from' && !Aurora.isEmpty(value)){
                   record.set('transaction_number_to', value);
               }
               var transaction_number_to = record.get('transaction_number_to');
               var transaction_number_from = record.get('transaction_number_from');
               
               if (transaction_number_from > transaction_number_to){
                   Aurora.showMessage('${l:HLS.PROMPT}', '批次编号区间出错！');
               }
            };
            
            Aurora.onReady(function() {
                var trans_num = '${/parameter/@transaction_number}';
                var ds_id_g = get_dsid_by_basetable(window['${/parameter/@layout_code}_layoutDataSetList'], 'rd_ebank_spd_txds71_doc');
                var ds_id_f = '${/parameter/@layout_code}_RD_QUERY__ds';
                var record = $(ds_id_f).getCurrentRecord();
                var btn_id = $('${/parameter/@layout_code}_user_button1');
                if (!Aurora.isEmpty(trans_num)) {
                    record.set('transaction_number_from', trans_num);
                    record.set('transaction_number_to', trans_num);
                    record.set('status', '');
                    record.set('status_desc', '');
                    btn_id.setVisible(true);
                    $(ds_id_g).query();
                } else {
                    btn_id.setVisible(false);
                }
            });
        ]]></script>
        <a:screen-include screen="modules/cont/CON500/con_contract_get_layout_code.screen"/>
    </a:view>
</a:screen>
