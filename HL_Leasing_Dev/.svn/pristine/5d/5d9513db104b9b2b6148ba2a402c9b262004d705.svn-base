<?xml version="1.0" encoding="UTF-8"?>
<a:screen xmlns:a="http://www.aurora-framework.org/application" customizationEnabled="true"  dynamiccreateenabled="true" trace="true">
    <a:init-procedure/>
    <a:view><script><![CDATA[
        window['${/parameter/@layout_code}_user_button1_layout_dynamic_click'] = function() {
            var ds_id = get_dsid_by_basetable(window['${/parameter/@layout_code}_layoutDataSetList'], 'con_contract');
            var grid_id = ds_id.replace('ds', 'layout_grid_id');
            $(grid_id)._export();
        };
        Aurora.onReady(function() {
            var ds_id_form='FACTORING_MANAGEMENT_FEE_STATE_F_QUERY__ds';
            var record=$(ds_id_form).getAt(0);
            var date = new Date();
            var year = date.getFullYear();
            var month = date.getMonth() + 1;
            month = (month < 10 ? "0"+month : month);
            var mydate = (year.toString() + '-' + month.toString());
            var mydate_num = parseInt(year+month);
            console.log(mydate_num);
            record.set('date_from_n', mydate);
            record.set('date_to_n', mydate);
            record.set('date_from', mydate_num);
            record.set('date_to', mydate_num);
            var ds_id = get_dsid_by_basetable(window['${/parameter/@layout_code}_layoutDataSetList'],  'con_contract');
            $(ds_id).query();
        });
        /*//add by Leauan 通过基表名&&布局组件获取ds_id
        function get_dsid_by_tabcode_basetable(layoutDataSetList, tab_code, base_table) {
            if (base_table && tab_code) {
                var base_table_temp = tab_code + '_' + base_table.toLowerCase() + '_ds';
                for (var i = 0; i < layoutDataSetList.length; i++) {
                    var dsId = layoutDataSetList[i];
                    if (dsId.substring(dsId.length - base_table_temp.length, dsId.length) == base_table_temp) {
                        return dsId;
                    }
                }
            }
            return '';
        }*/
        ]]></script>
        <a:screen-include screen="modules/cont/CON500/con_contract_get_layout_code.screen"/>
    </a:view>
</a:screen>
