<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: xuls  
    $Date: 2017-1-4 下午03:42:50  
    $Revision: 1.0  
    $Purpose: 
-->
<bm:model xmlns:bm="http://www.aurora-framework.org/schema/bm">
    <bm:operations>
        <bm:operation name="query">
            <bm:query-sql><![CDATA[
                
Select (Select (Case
                 When a.cf_description = '融资租赁资产' Then
                  (Select ar.comment_text_out
                     From zj_wfl_approve_record ar,
                          zj_wfl_workflow_node  wn,
                          con_contract          cc,
                          csh_payment_req_ln    b
                    Where ar.instance_id = cc.wfl_instance_id
                      And ar.node_id = wn.node_id
                      And b.ref_doc_id = cc.contract_id
                      And b.payment_req_id = h.payment_req_id
                      And wn.node_desc = '营业本部长审批车款支付申请'
                      And rownum = 1)
                 When a.cf_description = '业务委托费' Then
                  (Select ar.comment_text_out
                     From zj_wfl_approve_record ar, zj_wfl_workflow_node wn
                    Where ar.instance_id = h.wfl_instance_id
                      And ar.node_id = wn.node_id
                      And wn.node_desc = '营业本部长审批'
                      And rownum = 1)
               End) comment_text_out_4
          From CSH_PAYMENT_REQ_DEBT_LN_LV a
         Where a.payment_req_id = h.payment_req_id
           And rownum = 1) comment_text_out4,
       (Select (Case
                 When a.cf_description = '融资租赁资产' Then
                  (Select ar.creation_date
                     From zj_wfl_approve_record ar,
                          zj_wfl_workflow_node  wn,
                          con_contract          cc,
                          csh_payment_req_ln    b
                    Where ar.instance_id = cc.wfl_instance_id
                      And ar.node_id = wn.node_id
                      And b.ref_doc_id = cc.contract_id
                      And b.payment_req_id = h.payment_req_id
                      And wn.node_desc = '营业本部长审批车款支付申请'
                      And rownum = 1)
                 When a.cf_description = '业务委托费' Then
                  (Select ar.creation_date
                     From zj_wfl_approve_record ar, zj_wfl_workflow_node wn
                    Where ar.instance_id = h.wfl_instance_id
                      And ar.node_id = wn.node_id
                      And wn.node_desc = '营业本部长审批'
                      And rownum = 1)
               End) date4
          From CSH_PAYMENT_REQ_DEBT_LN_LV a
         Where a.payment_req_id = h.payment_req_id
           And rownum = 1) date4,
       (Select (Case
                 When a.cf_description = '融资租赁资产' Then
                  (Select ee.name
                     From zj_wfl_approve_record ar,
                          zj_wfl_workflow_node  wn,
                          sys_user              su,
                          exp_employees         ee,
                          con_contract          cc,
                          csh_payment_req_ln    b
                    Where ar.instance_id = cc.wfl_instance_id
                      And ar.node_id = wn.node_id
                      And wn.node_desc = '营业本部长审批车款支付申请'
                      And ar.created_by = su.user_id
                      And ee.employee_id = su.employee_id
                      And cc.contract_id = b.ref_doc_id
                      And b.payment_req_id = h.payment_req_id
                      And rownum = 1)
                 When a.cf_description = '业务委托费' Then
                  (Select ee.name
                     From zj_wfl_approve_record ar,
                          zj_wfl_workflow_node  wn,
                          sys_user              su,
                          exp_employees         ee
                    Where ar.instance_id = h.wfl_instance_id
                      And ar.node_id = wn.node_id
                      And wn.node_desc = '营业本部长审批'
                      And ar.created_by = su.user_id
                      And ee.employee_id = su.employee_id
                      And rownum = 1)
               End) user_4
          From CSH_PAYMENT_REQ_DEBT_LN_LV a
         Where a.payment_req_id = h.payment_req_id
           And ROWNUM = 1) user4,
       hl.ref_doc_id contract_id
  From csh_payment_req_hd h, csh_payment_req_ln hl
 Where h.payment_req_id = hl.payment_req_id
   And h.payment_req_id In (${:@payment_req_id})
            ]]></bm:query-sql>
        </bm:operation>
    </bm:operations>
</bm:model>
