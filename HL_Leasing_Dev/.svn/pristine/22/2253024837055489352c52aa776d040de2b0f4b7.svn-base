<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: zyx  
    $Date: 2016-12-7 下午02:44:52  
    $Revision: 1.0  
    $Purpose: 风险金池
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application" customizationEnabled="true" dynamiccreateenabled="true" trace="true">
    <!-- <a:init-procedure>
        <a:model-query fetchAll="true" model="csh.CSH570.risk_status" rootPath="risk_status"/>
    </a:init-procedure> -->
    <a:view>
        <a:link id="csh570_risk_vat_link" url="${/request/@context_path}/modules/csh/CSH570/risk_vat_input.screen"/>
        <a:link id="csh_transaction_receipt_write_off_detail_link" url="${/request/@context_path}/modules/csh/CSH513/csh_transaction_receipt_write_off_detail.screen"/>
        <script><![CDATA[
        window['${/parameter/@layout_code}_user_button1_layout_dynamic_click'] = function() {
                var risk_record = $('csh_transaction_receipt_write_off_result_ds').getAt(0);
            	/* var transaction_id='${/model/risk_status/record/@transaction_id}';
            	var transaction_type='${/model/risk_status/record/@transaction_type}';
                var risk_status = '${/model/risk_status/record/@status}'; */
                var transaction_id=risk_record.get('transaction_id');
            	var transaction_type=risk_record.get('transaction_type');
                var risk_status = risk_record.get('status');
                debugger;
				if(risk_status == 'APPROVING'){
				    Aurora.showMessage('提示','正在审批中，请通过后继续操作!');
				    return ;
				}else{
				    var win=new Aurora.Window({
	                    id: 'receipt_write_off_detail_link_winid',
	                    params: {
	                        winId: 'receipt_write_off_detail_link_winid',
	                        type: 'RISK',
	                        limit3_flag: 'Y',
	                        transaction_id: transaction_id,
	                        transaction_type:transaction_type,
	                        auto_filt_prinicipal_interest:'Y',
	                        bp_limit_flag:'Y'
	                    },
	                    url: $('csh_transaction_receipt_write_off_detail_link').getUrl(),
	                    title: '${l:CSH513.CSH_RECEIPT_WRITE_OFF}',
	                    fullScreen: true
					});
					/* win.on('close',function(){
						 $('csh570_risk_ds').query();
					}); */
				}
            };
            
            window['${/parameter/@layout_code}_user_button2_layout_dynamic_click'] = function() {
                var left_amount = $('RISK_ENTRANCE_F_QUERY__ds').getAt(0).get('risk_amount_n');
                var win=new Aurora.Window({
	                    id: 'csh570_vat_win_id',
	                    params: {
	                        winId: 'csh570_vat_win_id',
	                        left_amount: left_amount
	                    },
	                    url: $('csh570_risk_vat_link').getUrl(),
	                    title: '风险金税金录入',
	                    width: 500,
                        height: 200,
					});
            };
            function csh570_reload(){
                window.location.reload();
            }
        ]]></script>
        <a:screen-include screen="modules/cont/CON500/con_contract_get_layout_code.screen"/>
        <a:dataSets>
            <a:dataSet id="csh_transaction_receipt_write_off_result_ds" autoQuery="true" model="csh.CSH570.risk_status"/>
        </a:dataSets>
    </a:view>
</a:screen>
