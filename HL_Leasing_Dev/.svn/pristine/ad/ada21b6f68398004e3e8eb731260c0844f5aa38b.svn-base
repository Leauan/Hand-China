<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author:Yenick  
    $Date: 2018-5-08
    $Revision: 1.0  
    $Purpose:农行代扣数据导入明细
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application" customizationEnabled="true" dynamiccreateenabled="true" trace="true">
    <a:init-procedure outputPath="/parameter">
        <!--  <a:model-query model="basic.hls_fnd_attribute_sequence" rootPath="header"/>
        <a:import-excel header_id="${/model/header/record/@header_id}" separator="," status_field="/parameter/@ImportSuccess" template_code="ACR_EBANK" user_id="${/session/@user_id}"/>
        <a:model-query defaultWhereClause="header_id=${/model/header/record/@header_id} and TEMPLATE_CODE = &apos;ACR_EBANK&apos;" model="basic.hls_fnd_attribute_status" rootPath="status"/> --><![CDATA[
        
    ]]></a:init-procedure>
    <a:view>
        <a:link id="acr_invoice_import_update_data_link" model="hls_acr.HLS_ACR5040.hls_acr_import_data_insert" modelaction="update"/>
        <a:link id="acr_ebank_import_link" url="${/request/@context_path}/modules/hls_acr/HLS_ACR5040/hls_acr_ebank_import_upload.screen"/>
        <a:link id="hls_acr_ebank_enter_link" url="${/request/@context_path}/modules/hls_acr/HLS_ACR5040/hls_acr_ebank_input.screen"/>
        <script><![CDATA[
            window['${/parameter/@layout_code}_user_button1_layout_dynamic_click'] = function() {
                debugger;
                var win = new Aurora.Window({
                    id: 'upload_handle_winId',
                    params: {
                        output_id: '${/parameter/@output_id}'
                    },
                    url: $('acr_ebank_import_link').getUrl(),
                    title: '农行信息导入',
                    width: 420,
                    height: 275
                }).on('close', function() {});
            };
            window['${/parameter/@layout_code}_user_button2_layout_dynamic_click'] = function() {
                Aurora.request({
                    url: $('acr_invoice_import_update_data_link').getUrl(),
                    para: {
                        output_id: '${/parameter/@output_id}'
                    },
                    success: function() {
                         window.location.href = $('hls_acr_ebank_enter_link').getUrl()+ '?layout_code=' + 'HLS_ACR5030_HEADER' + '&function_code=HLS_ACR5040';
                     Aurora.SideBar.show({
                            msg: '操作成功',
                            duration: 2000
                        });
                    },
                    failure: function() {},
                    error: function() {},
                    scope: this
                });
            };
             window['${/parameter/@layout_code}_user_button3_layout_dynamic_click'] = function() {
                  window.location.href = $('hls_acr_ebank_enter_link').getUrl()+ '?layout_code=' + 'HLS_ACR5030_HEADER' + '&function_code=HLS_ACR5040';
            };
            window['${/parameter/@layout_code}_upload_layout_dynamic_click'] = function() {
                var p_sourcetype = 'hls_acr_ebank_input';
                var p_pkvalue = '${/session/@session_id}';
                var url = '${/request/@context_path}/modules/hls_acr/HLS_ACR5030/hls_upload_for_attachment_db_view.screen?sourcetype=' + p_sourcetype + '&' + 'pkvalue=' + p_pkvalue;
                wd = new Aurora.Window({
                    id: 'attachment_up_window',
                    url: url,
                    title: '附件上传',
                    height: 350,
                    width: 850
                });
            };
            //查询时调用(grid,table,gridBox)
            window['${/parameter/@bp_seq}${/parameter/@layout_code}_on_layout_dynamic_grid_query'] = function(ds, qpara, bp_seq) {
                qpara['output_id'] = '${/parameter/@output_id}';
            };
        ]]></script>
        <a:screen-include screen="modules/cont/CON500/con_contract_get_layout_code.screen"/>
    </a:view>
</a:screen>
