<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: dingzhichao 2855  
    $Date: 2011-6-13 上午11:18:10  
    $Revision: 1.0  
    $Purpose:银行代扣数控导入
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application" customizationEnabled="true" dynamiccreateenabled="true" trace="true">
    <a:init-procedure><![CDATA[
    ]]></a:init-procedure>
    <a:view>
        <script><![CDATA[
        window['${/parameter/@layout_code}_user_button1_layout_dynamic_click'] = function() {
            debugger;
            var record = $('HLS_ACR5030_IN_HD__ds').getCurrentRecord();
            var due_date = record.get("due_date");
            var dd_bank_account_num = record.get("dd_bank_account_num");
            var withhold_way = record.get("withhold_way");
            var currency = record.get("currency");
            var bank_doc_number = record.get('bank_doc_number');
            var description = record.get("description");
            if (!due_date) {
                Aurora.showErrorMessage("错误信息", " 收款日期不能为空");
                return false;
            }
            if (!dd_bank_account_num) {
                Aurora.showErrorMessage("错误信息", " 收款账号不能为空");
                return false;
            }
            if (!withhold_way) {
                Aurora.showErrorMessage("错误信息", " 租金支付方式不能为空");
                return false;
            }
            if (!currency) {
                Aurora.showErrorMessage("错误信息", " 币种不能为空");
                return false;
            }
            if (due_date && dd_bank_account_num && withhold_way && currency) {
                Aurora.request({
                    url: '${/request/@context_path}/autocrud/hls_acr.HLS_ACR5030.run_ebank_input/execute'/*$('run_ebank_input_link').getUrl()*/,
                    para: {
                        collection_date: due_date,
                        collection_account_id: dd_bank_account_num,
                        payment_method: withhold_way,
                        currency_code: currency,
                        bank_doc_number: bank_doc_number,
                        description: description
                    },
                    success: function(args) {
                        //Aurora.showMessage("提示信息","代扣信息生成成功",return_back);
                        $('HLS_ACR5030_IN_LINE_hls_acr_ebank_process_temp_ds').query();
                    },
                    scope: this
                });
            }
        };
        window['${/parameter/@layout_code}_user_button2_layout_dynamic_click'] = function() {

        };
        window['${/parameter/@layout_code}_upload_layout_dynamic_click'] = function() {
            var p_sourcetype = 'hls_acr_ebank_input';
            var p_pkvalue = '${/session/@session_id}';
            var url = '${/request/@context_path}/modules/hls_acr/HLS_ACR5030/hls_upload_for_attachment_db_view.screen?sourcetype=' + p_sourcetype + '&' + 'pkvalue=' + p_pkvalue;
            wd = new Aurora.Window({
                id: 'attachment_up_window',
                url: url,
                title: '附件上传',
                height: 350,
                width: 850
            });
        };
        ]]></script>
        <a:screen-include screen="modules/cont/CON500/con_contract_get_layout_code.screen"/>
    </a:view>
</a:screen>
