<?xml version="1.0" encoding="UTF-8"?>
<a:screen xmlns:a="http://www.aurora-framework.org/application" trace="true">
    <a:init-procedure>
        <!-- <a:model-query model="sys.sys_system_maintenance_status" rootPath="sys_system_maintenance_status"/> --><![CDATA[
        
        
        
        
    ]]></a:init-procedure>
    <a:view template="default">
        <a:link id="pageLink_loginPage_role_select" url="${/request/@context_path}/role_select.screen"/>
        <a:link id="pageLink_expired_passwd_update" url="${/request/@context_path}/password_expired_update.screen"/>
        <a:link id="svcLink_login" url="${/request/@context_path}/login.svc"/>
        <a:dataSets>
            <a:dataSet id="langDs">
                <a:datas>
                    <a:record name="简体中文" code="ZHS"/>
                    <a:record name="English" code="US"/>
                </a:datas>
            </a:dataSet>
            <a:dataSet id="loginDs" autoCreate="true">
                <a:fields>
                    <a:field name="user_name"/>
                    <a:field name="user_password"/>
                    <a:field name="language" displayField="name" options="langDs" returnField="user_language" valueField="code"/>
                </a:fields>
            </a:dataSet>
        </a:dataSets>
        <script><![CDATA[
            Aurora.Status.enable = false;
            Aurora.SideBar.enable = false;
            
            function deleteJSID() {
                var date = new Date();
                date.setTime(date.getTime() - 10000);
                document.cookie = "JSID=; expires=" + date.toGMTString();
            }
            
            deleteJSID();
            
            function login() {
                var lds = $('loginDs');
                var record = lds.getCurrentRecord();
                //不允许pad
                record.set('is_ipad', 'N');
                Aurora.request({
                    url: $('svcLink_login').getUrl(),
                    para: record.data,
                    success: function(res) {
                        if (res.result['encryted_session_id'] == 'ERROR') {
                            Aurora.showInfoMessage('${l:PROMPT}', res.result['message'], function(cmp) {
                                cmp.close();
                                new Aurora.Window({
                                    url: $('pageLink_expired_passwd_update').getUrl() + '?user_name=' + $('loginDs').getAt(0).get('user_name'),
                                    title: ' ',
                                    id: 'password_expired_update_screen',
                                    width: 350,
                                    height: 200
                                });
                            }, 250, 100);
                        } else {
                            saveUserNameLang();
                            window.location.href = $('pageLink_loginPage_role_select').getUrl() + location.search;
                        }
                    },
                    scope: this
                });
            }
            
            function saveUserNameLang() {
                var record = $('loginDs').getAt(0);
                Aurora.setCookie('USERNAME', record.get('user_name'), 30);
                Aurora.setCookie('LANG', record.get('user_language'), 30); 
            }
            
            function forgorPwd() {
                var user_name = $('loginDs').getAt(0).get('user_name');
                if (user_name) {
                    new Aurora.Window({
                        url: $('pageLink_expired_passwd_update').getUrl() + '?user_name=' + user_name,
                        title: ' ',
                        id: 'password_expired_update_screen',
                        width: 350,
                        height: 200
                    });
                } else {
                    Aurora.showMessage('${l:PROMPT}', '请先在登录页面填写用户名。');
                }
            
            }
        ]]></script>
        <style><![CDATA[
            
            
            html,body{
                overflow:hidden;
                height:100%;
                width:100%;
                font-family:微软雅黑,宋体,tahoma,arial,sans-serif,helvetica;
                font-size:12px;
            }
            .loginFormTitle {
                letter-spacing:10px;font-weight:bold;font-size:28px;text-align:center;margin:20px 0px 5px 0px;color:#002d4f
            }
            .loginFormTitle2{
                font-size:15px;
                font-weight:bold;
                text-align:center;
                color:#002d4f
            }
            .loginFormIpt {
                position: relative;
                width: 240px;
                height: 42px;
                line-height: 42px;
                margin-left: auto;
                margin-right:auto;
                margin-top:20px;
                padding-right: 5px;
                clear: both;
                z-index: 2;
                background-image: url(${/request/@context_path}/images/bestseller/formInpt.png);
                background-repeat : no-repeat;
            }
            .loginFormIpt input{
                background: transparent!important;
            }
            .loginFormIpt .ico {
                position: absolute;
                left: 9px;
                top: 13px;
                z-index: 1;
                background-image: url(${/request/@context_path}/images/bestseller/formIco.png);
                background-repeat : no-repeat;
            }
            .ico-uid {
                width: 14px;
                height: 16px;
                background-position: 0px 0px;
            }
            .ico-pwd {
                width: 14px;
                height: 16px;
                background-position: -24px 0px;
            }
            .loginForm {
                background: url(${/request/@context_path}/images/bestseller/bg.png); 
                padding-top:20px;
                width:350px;
                left:-10000px;
                top:-10000px;
                position:absolute;
            }
            .formIpt {
                position:absolute;
                ime-mode: disabled;
                top: 10px;
                left: 28px;
                color: #333;
                font-size: 14px;
                font-weight: 700;
                border: none;
                font-family: verdana;
                line-height: 21px;
                background: transparent!important;
            }
            .langRadio {
                margin:auto;
                margin-top:30px;
            }
            
            .item-radio:focus{
                outline:1px dotted black;
            }
            .langRadio .item-radio-option{
                margin-right:30px;
            }
            .langRadio .item-radio-lb{
                margin-left:5px;
                font-size:14px;
                color:#002d4f;
            }
            .item-btn-infor button{
                font-size:14px;
                font-weight: 700;
            }
            .bottomBar {
                font-family:sans-serif;
                font-size:12px;
                margin-top:30px;
                text-decoration:underline;
                color:#002d4f;
            }
            .bottomBar a{
                text-decoration:underline;
                color:#002d4f;
            }
            .forgotPwd {
                margin-left:55px;
            }
            .helpLnk {
                margin-left:40px;
            }
            .item-btn-bs {
                font-size:16px;
            }
            
            .image {
                padding-top:320px;
                width:1175px;
                color:#FFFFFF;
            }
            
            
            .image_div {
                float:left;
                width:120px;
                padding-left:30px;
                padding-right:10px;
                margin:0px;
                text-align:center
            }
            .image_div_span {
                font-family:微软雅黑,宋体,tahoma,arial,sans-serif,helvetica;font-size:14px;
                color:black;
                margin:0 auto;
            }
            .Operation_Tips_class{
                width:200px;
                height:260px;
                position:absolute;
                display:none;
                z-index:9999;
                background-color:rgba(255,255,255,0.6);
                filter: progid:DXImageTransform.Microsoft.gradient(startColorstr=#66ffffff,endColorstr=#66ffffff);
            }
        ]]></style>
        <img id="zoomWallpaper" src="${/request/@context_path}/images/bestseller/login_bg.jpg" style="left: 0px; top: 0px; position: absolute;z-index:0" width="100%"/>
        <div id="loginForm" class="loginForm">
            <table>
                <tr>
                    <td>
                        <div class="loginFormTitle"><![CDATA[融资租赁系统]]></div>
                        <div class="loginFormTitle2"><![CDATA[Financial Leasing System]]></div>
                        <div style="padding:20px 0px 20px 0px;width:350px;">
                            <div class="loginFormIpt">
                                <b class="ico ico-uid"/>
                                <a:textField name="user_name" id="user_name_tf" bindTarget="loginDs" className="formIpt" emptyText="用户名/User name" width="215">
                                    <a:events>
                                        <a:event name="enterdown" handler="login"/>
                                    </a:events>
                                </a:textField>
                            </div>
                            <div class="loginFormIpt">
                                <b class="ico ico-pwd"/>
                                <a:passWord name="user_password" bindTarget="loginDs" className="formIpt" emptyText="密码Username" width="215">
                                    <a:events>
                                        <a:event name="enterdown" handler="login"/>
                                    </a:events>
                                </a:passWord>
                            </div>
                            <div id="radio_id">
                                <span id="ZHS_id" style="position: relative;left:62px;top:20px;background: transparent!important;">
                                    <img id="ZHS_radio1_id" src="images/bestseller/radio_checked.png"/>
                                    <img id="ZHS_radio2_id" src="images/bestseller/radio_unchecked.png" style="display:none;"/>
                                    <span style="font-family:微软雅黑,宋体,tahoma,arial,sans-serif,helvetica;font-size:14px;"><![CDATA[ 中文]]></span>
                                </span>
                                <span id="US_id" style="position: relative;left:185px;top:20px;background: transparent!important;">
                                    <img id="US_radio1_id" src="images/bestseller/radio_unchecked.png"/>
                                    <img id="US_radio2_id" src="images/bestseller/radio_checked.png" style="display:none;"/>
                                    <span style="font-family:微软雅黑,宋体,tahoma,arial,sans-serif,helvetica;font-size:14px;"><![CDATA[ English]]></span>
                                </span>
                                <br/>
                            </div> 
                            <div>
                                <a:button id="button_id" className="item-btn-bs" click="login" height="30" style="margin:auto;margin-top:20px;margin-bottom:10px;" text="登陆  Sign in" width="245">
                                    <a:events>
                                        <a:event name="enterdown" handler="login"/>
                                    </a:events>
                                </a:button>
                            </div>
                            <div class="bottomBar">
                                <!-- <a class="forgotPwd" href="javascript:forgorPwd()"><![CDATA[忘记密码 /Forgot Password]]></a> -->
                                <!-- <a class="helpLnk" href="modules/cux/CUX2040/cux_ems_help_guide.screen"><![CDATA[帮助/ Help]]></a> --><![CDATA[
                                
                                
                            ]]></div>
                        </div>
                    </td>
                    <!-- <td>
                        <div id="image" class="image" style="padding-left:50px;">
                            <div class="image_div">
                                <span>
                                    <div>
                                        <img id="image_ios9andafter" onmousemove="Operation_Tips(event);" onmouseout="Operation_Tips_hide();" src="images/bestseller/ios.png" style="width:100%"/>
                                    </div>
                                    <div>
                                        <span id="image_div_span_ios9andafter" class="image_div_span"><![CDATA[IOS]]></span>
                                    </div>
                                </span>
                            </div>
                            <div class="image_div">
                                <span>
                                    <div>
                                        <a href="http://emsnew.bestseller.com.cn/download/HandHRMS.apk">
                                            <img id="android" src="images/bestseller/android.png" style="width:100%"/>
                                        </a>
                                    </div>
                                    <div>
                                        <span id="image_div_span_android" class="image_div_span"><![CDATA[ANDROID]]></span>
                                    </div>
                                </span>
                            </div>
                        </div>
                    </td> -->
                </tr>
            </table>
        </div>
        <div id="Operation_Tips_id" class="Operation_Tips_class"/>
        <script><![CDATA[
            Aurora.onReady(function() {
                Aurora.center('loginForm');
                Aurora.get('loginForm').show();
                //init();
                var record =$('loginDs').getAt(0);
                record.set('user_name',Aurora.getCookie('USERNAME'));
				
				var lang = Aurora.getCookie('LANG');
				record.set('user_language',lang);
            
                var ZHS = document.getElementById('ZHS_id');
                var ZHS_radio1 = document.getElementById('ZHS_radio1_id');
                var ZHS_radio2 = document.getElementById('ZHS_radio2_id');
                var US = document.getElementById('US_id');
                var US_radio1 = document.getElementById('US_radio1_id');
                var US_radio2 = document.getElementById('US_radio2_id');
            
                function show_lang(lang) {
                    if (lang == 'US') {
                        ZHS_radio1.style.display = "none";
                        ZHS_radio2.style.display = "inline";
                        US_radio1.style.display = "none";
                        US_radio2.style.display = "inline";
                        $('loginDs').getCurrentRecord().set('user_language', 'US');
                       // document.getElementById("image_div_span_ios9andafter").innerHTML = "IOS";
                       // document.getElementById("image_div_span_android").innerHTML = "ANDROID";
            
                    } else {
                        ZHS_radio2.style.display = "none";
                        ZHS_radio1.style.display = "inline";
                        US_radio2.style.display = "none";
                        US_radio1.style.display = "inline";
                        $('loginDs').getCurrentRecord().set('user_language', 'ZHS');
                       // document.getElementById("image_div_span_ios9andafter").innerHTML = "IOS";
                       // document.getElementById("image_div_span_android").innerHTML = "ANDROID";
                    }
                }
                
                show_lang(lang);
                Ext.lib.Event.on(ZHS, 'click', function() {
                    var lang = $('loginDs').getCurrentRecord().get('user_language');
                    if (lang == 'US') {
                        show_lang('ZHS');
                    } else {
                        show_lang('US');
                    }
                }, true);
            
                Ext.lib.Event.on(US, 'click', function() {
                    var lang = $('loginDs').getCurrentRecord().get('user_language');
                    if (lang == 'US') {
                        show_lang('ZHS');
                    } else {
                        show_lang('US');
                    }
                }, true);
            
            });
        ]]></script>
    </a:view>
</a:screen>
