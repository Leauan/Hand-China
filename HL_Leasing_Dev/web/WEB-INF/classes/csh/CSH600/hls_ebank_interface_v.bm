<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: Razgriz.Tang  
    $Date: 2014-3-26 上午10:37:41  
    $Revision: 1.0  
    $Purpose: 
-->
<bm:model xmlns:bm="http://www.aurora-framework.org/schema/bm" alias="t1" baseTable="HLS_EBANK_INTERFACE_V" defaultOrderBy="contract_number,times">
    <bm:fields>
        <bm:field name="interface_id" databaseType="NUMBER" datatype="java.lang.Long" physicalName="INTERFACE_ID" prompt="HLS_EBANK_INTERFACE_V.INTERFACE_ID"/>
        <bm:field name="company_id" databaseType="NUMBER" datatype="java.lang.Long" physicalName="COMPANY_ID" prompt="HLS_EBANK_INTERFACE_V.COMPANY_ID"/>
        <bm:field name="cashflow_id" databaseType="NUMBER" datatype="java.lang.Long" physicalName="CASHFLOW_ID" prompt="HLS_EBANK_INTERFACE_V.CASHFLOW_ID"/>
        <bm:field name="priority" databaseType="NUMBER" datatype="java.lang.Long" physicalName="PRIORITY" prompt="HLS_EBANK_INTERFACE_V.PRIORITY"/>
        <bm:field name="bp_id" databaseType="NUMBER" datatype="java.lang.Long" physicalName="bp_id" prompt="HLS_EBANK_INTERFACE_V.bp_name"/>
        <bm:field name="bp_name" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="bp_name" prompt="HLS_EBANK_INTERFACE_V.bp_name"/>
        <bm:field name="contract_id" databaseType="NUMBER" datatype="java.lang.Long" physicalName="CASHFLOW_ID" prompt="HLS_EBANK_INTERFACE_V.CASHFLOW_ID"/>
        <bm:field name="contract_number" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="CONTRACT_NUMBER" prompt="HLS_EBANK_INTERFACE_V.CONTRACT_NUMBER"/>
        <bm:field name="times" databaseType="NUMBER" datatype="java.lang.Long" physicalName="TIMES" prompt="HLS_EBANK_INTERFACE_V.TIMES"/>
        <bm:field name="cf_item" databaseType="NUMBER" datatype="java.lang.Long" physicalName="CF_ITEM" prompt="HLS_EBANK_INTERFACE_V.CF_ITEM"/>
        <bm:field name="cf_item_desc" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="CF_ITEM_DESC" prompt="HLS_EBANK_INTERFACE_V.CF_ITEM_DESC"/>
        <bm:field name="due_date" databaseType="VARCHAR2" datatype="java.lang.String" expression="to_char(t1.due_date, &apos;yyyy-mm-dd&apos;)" prompt="HLS_EBANK_INTERFACE_V.DUE_DATE"/>
        <bm:field name="due_amount" databaseType="NUMBER" datatype="java.lang.Double" physicalName="DUE_AMOUNT" prompt="HLS_EBANK_INTERFACE_V.DUE_AMOUNT"/>
        <bm:field name="funnam" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="FUNNAM" prompt="HLS_EBANK_INTERFACE_V.FUNNAM"/>
        <bm:field name="dattyp" databaseType="NUMBER" datatype="java.lang.Long" physicalName="DATTYP" prompt="HLS_EBANK_INTERFACE_V.DATTYP"/>
        <bm:field name="lgnnam" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="LGNNAM" prompt="HLS_EBANK_INTERFACE_V.LGNNAM"/>
        <bm:field name="buscod" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="BUSCOD" prompt="HLS_EBANK_INTERFACE_V.BUSCOD"/>
        <bm:field name="buscod_display" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="BUSCOD_DISPLAY" prompt="HLS_EBANK_INTERFACE_V.BUSCOD_DISPLAY"/>
        <bm:field name="busmod" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="BUSMOD" prompt="HLS_EBANK_INTERFACE_V.BUSMOD"/>
        <bm:field name="modals" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="MODALS" prompt="HLS_EBANK_INTERFACE_V.MODALS"/>
        <bm:field name="trstyp" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="TRSTYP" prompt="HLS_EBANK_INTERFACE_V.TRSTYP"/>
        <bm:field name="c_trstyp" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="C_TRSTYP" prompt="HLS_EBANK_INTERFACE_V.C_TRSTYP"/>
        <bm:field name="eptdat" databaseType="DATE" datatype="java.util.Date" expression="to_char(t1.eptdat, &apos;yyyy-mm-dd&apos;)" prompt="HLS_EBANK_INTERFACE_V.EPTDAT"/>
        <bm:field name="dbtacc" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="DBTACC" prompt="HLS_EBANK_INTERFACE_V.DBTACC"/>
        <bm:field name="bbknbr" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="BBKNBR" prompt="HLS_EBANK_INTERFACE_V.BBKNBR"/>
        <bm:field name="bankarea" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="BANKAREA" prompt="HLS_EBANK_INTERFACE_V.BANKAREA"/>
        <bm:field name="sum" databaseType="NUMBER" datatype="java.lang.Double" physicalName="SUM" prompt="HLS_EBANK_INTERFACE_V.SUM"/>
        <bm:field name="total" databaseType="NUMBER" datatype="java.lang.Long" physicalName="TOTAL" prompt="HLS_EBANK_INTERFACE_V.TOTAL"/>
        <bm:field name="ccynbr" databaseType="NUMBER" datatype="java.lang.Long" physicalName="CCYNBR" prompt="HLS_EBANK_INTERFACE_V.CCYNBR"/>
        <bm:field name="currency" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="CURRENCY" prompt="HLS_EBANK_INTERFACE_V.CURRENCY"/>
        <bm:field name="yurref" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="YURREF" prompt="HLS_EBANK_INTERFACE_V.YURREF"/>
        <bm:field name="memo" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="MEMO" prompt="HLS_EBANK_INTERFACE_V.MEMO"/>
        <bm:field name="accnbr" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="ACCNBR" prompt="HLS_EBANK_INTERFACE_V.ACCNBR"/>
        <bm:field name="cltnam" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="CLTNAM" prompt="HLS_EBANK_INTERFACE_V.CLTNAM"/>
        <bm:field name="trsamt" databaseType="NUMBER" datatype="java.lang.Double" physicalName="TRSAMT" prompt="HLS_EBANK_INTERFACE_V.TRSAMT"/>
        <bm:field name="bnkflg" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="BNKFLG" prompt="HLS_EBANK_INTERFACE_V.BNKFLG"/>
        <bm:field name="eacbnk" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="EACBNK" prompt="HLS_EBANK_INTERFACE_V.EACBNK"/>
        <bm:field name="eaccty" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="EACCTY" prompt="HLS_EBANK_INTERFACE_V.EACCTY"/>
        <bm:field name="trsdsp" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="TRSDSP" prompt="HLS_EBANK_INTERFACE_V.TRSDSP"/>
        <bm:field name="retcod" databaseType="NUMBER" datatype="java.lang.Long" physicalName="RETCOD" prompt="HLS_EBANK_INTERFACE_V.RETCOD"/>
        <bm:field name="retcod_display" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="RETCOD_DISPLAY" prompt="HLS_EBANK_INTERFACE_V.RETCOD_DISPLAY"/>
        <bm:field name="errmsg" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="ERRMSG" prompt="HLS_EBANK_INTERFACE_V.ERRMSG"/>
        <bm:field name="reqnbr" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="REQNBR" prompt="HLS_EBANK_INTERFACE_V.REQNBR"/>
        <bm:field name="oprdat" databaseType="DATE" datatype="java.util.Date" physicalName="OPRDAT" prompt="HLS_EBANK_INTERFACE_V.OPRDAT"/>
        <bm:field name="trs_status" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="TRS_STATUS" prompt="HLS_EBANK_INTERFACE_V.TRS_STATUS"/>
        <bm:field name="trs_status_display" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="TRS_STATUS_DISPLAY" prompt="HLS_EBANK_INTERFACE_V.TRS_STATUS_DISPLAY"/>
        <bm:field name="confirm_date" databaseType="DATE" datatype="java.util.Date" physicalName="CONFIRM_DATE" prompt="HLS_EBANK_INTERFACE_V.CONFIRM_DATE"/>
        <bm:field name="submit_date" databaseType="VARCHAR2" datatype="java.lang.String" expression="to_char(t1.submit_date, &apos;yyyy-mm-dd&apos;)" prompt="HLS_EBANK_INTERFACE_V.SUBMIT_DATE"/>
        <bm:field name="write_off_flag_display" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="WRITE_OFF_FLAG_DISPLAY" prompt="HLS_EBANK_INTERFACE_V.WRITE_OFF_FLAG_DISPLAY"/>
        <bm:field name="write_off_amount" databaseType="NUMBER" datatype="java.lang.Double" physicalName="WRITE_OFF_AMOUNT" prompt="HLS_EBANK_INTERFACE_V.WRITE_OFF_AMOUNT"/>
        <bm:field name="full_write_off_date" databaseType="VARCHAR2" datatype="java.lang.String" expression="to_char(t1.full_write_off_date, &apos;yyyy-mm-dd&apos;)" prompt="HLS_EBANK_INTERFACE_V.FULL_WRITE_OFF_DATE"/>
        <bm:field name="csh_transaction_id" databaseType="NUMBER" datatype="java.lang.Long" physicalName="CSH_TRANSACTION_ID" prompt="HLS_EBANK_INTERFACE_V.CSH_TRANSACTION_ID"/>
        <bm:field name="csh_transaction_num" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="CSH_TRANSACTION_NUM" prompt="HLS_EBANK_INTERFACE_V.CSH_TRANSACTION_NUM"/>
        <bm:field name="manual_flag" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="MANUAL_FLAG" prompt="HLS_EBANK_INTERFACE_V.MANUAL_FLAG"/>
        <bm:field name="bank_short_name" databaseType="VARCHAR2" datatype="java.lang.String"/>
        <bm:field name="bbknbr_desc" databaseType="VARCHAR2" datatype="java.lang.String"/>
        <bm:field name="protocol_number" databaseType="VARCHAR2" datatype="java.lang.String"/>
        <bm:field name="ebank_protocol_status" databaseType="VARCHAR2" datatype="java.lang.String"/>
        <bm:field name="ebank_protocol_status_n" databaseType="VARCHAR2" datatype="java.lang.String"/>
        <bm:field name="debit_number" databaseType="VARCHAR2" datatype="java.lang.String"/>
        <bm:field name="company_name"/>
    </bm:fields>
    <bm:operations>
        <bm:operation name="query">
            <bm:query-sql><![CDATA[
    			select interface_id, 
						company_id, 
						company_name,
						cashflow_id, 
						priority, 
						bp_id,
						bp_name, 
						contract_id,
						contract_number, 
						times, 
						cf_item,
						cf_item_desc, 
						to_char(due_date, 'yyyy-mm-dd') as due_date, 
						due_amount, 
						funnam, 
						dattyp, 
						lgnnam, 
						buscod, 
						buscod_display, 
						busmod, 
						modals, 
						trstyp, 
						c_trstyp, 
						to_char(eptdat, 'yyyy-mm-dd') as eptdat,
						dbtacc, 
						bbknbr,
						bbknbr_desc, 
						bankarea, 
						sum, 
						total, 
						ccynbr, 
						currency, 
						yurref, 
						memo, 
						accnbr, 
						cltnam, 
						trsamt, 
						bnkflg, 
						eacbnk, 
						eaccty, 
						trsdsp, 
						retcod, 
						retcod_display, 
						errmsg, 
						reqnbr, 
						oprdat, 
						trs_status, 
						trs_status_display, 
						to_char(confirm_date, 'yyyy-mm-dd') as confirm_date, 
						to_char(submit_date, 'yyyy-mm-dd hh24:mi:ss') as submit_date, 
	                    nvl(write_off_amount,0) as write_off_amount,
						write_off_flag_display, 
						to_char(full_write_off_date, 'yyyy-mm-dd') as full_write_off_date, 
	   					csh_transaction_id,
						csh_transaction_num,
						manual_flag,
						bank_id,
						bank_short_name,
						protocol_number,
						ebank_protocol_status,
						ebank_protocol_status_n,
						debit_number
						
				  from HLS_EBANK_INTERFACE_V t1
				  #WHERE_CLAUSE#
				 order by t1.contract_number, t1.times
    		]]></bm:query-sql>
        </bm:operation>
        <bm:operation name="insert">
            <bm:parameters>
                <bm:parameter name="interface_id" input="false" output="true" outputPath="@interface_id"/>
            </bm:parameters>
            <bm:update-sql><![CDATA[
        		begin
				  HLS_EBANK_PKG.interface_manipulation
				  (
				      p_sql_type	  => 'INSERT',
  					  p_interface_id  => ${@interface_id},
				      p_company_id    => ${/session/@company_id},
				      p_cashflow_id   => ${@cashflow_id},
				      p_priority      => ${@priority},
				      p_eptdat        => to_date(${@eptdat}, 'yyyy-mm-dd'),
				      p_dbtacc        => ${@dbtacc},
				      p_bbknbr        => '',
				      p_bankarea      => '',
				      p_sum           => ${@trsamt},
				      p_currency      => ${@currency},
				      p_yurref        => ${@yurref},
				      p_memo          => ${@memo},
				      p_accnbr        => ${@accnbr},
				      p_cltnam        => ${@cltnam},
				      p_trsamt        => ${@trsamt},
				      p_bnkflg        => 'Y',
				      p_eacbnk        => '',
				      p_eaccty        => '',
				      p_trsdsp        => '',
				      p_retcod        => '',
				      p_errmsg        => '',
				      p_reqnbr        => '',
				      p_oprdat        => '',
				      p_trs_status    => 'NEW',
				      p_confirm_date  => '',
				      p_submit_date   => '',
				      p_manual_flag   => ${@manual_flag},
				      p_user_id       => ${/session/@user_id},
				      p_bank_id       => ${/session/@bank_id}
				  );
				end;
        	]]></bm:update-sql>
        </bm:operation>
        <bm:operation name="update">
            <bm:update-sql><![CDATA[
        		begin
				  HLS_EBANK_PKG.update_hls_ebank_interface(p_interface_id => ${@interface_id},
                                       p_dbtacc      => ${@dbtacc},
                                       p_user_id     => ${/session/@user_id});
				end;
        	]]></bm:update-sql>
        </bm:operation>
        <bm:operation name="delete">
            <bm:update-sql><![CDATA[
        		begin
				  HLS_EBANK_PKG.interface_manipulation
				  (
				      p_sql_type	  => 'DELETE',
  					  p_interface_id  => ${@interface_id},
				      p_company_id    => ${@company_id},
				      p_cashflow_id   => ${@cashflow_id},
				      p_priority      => ${@priority},
				      p_eptdat        => to_date(${@due_date}, 'yyyy-mm-dd'),
				      p_dbtacc        => ${@dbtacc},
				      p_bbknbr        => ${@bbknbr},
				      p_bankarea      => ${@bankarea},
				      p_sum           => ${@due_amount},
				      p_currency      => ${@currency},
				      p_yurref        => ${@yurref},
				      p_memo          => ${@memo},
				      p_accnbr        => ${@accnbr},
				      p_cltnam        => ${@cltnam},
				      p_trsamt        => ${@due_amount},
				      p_bnkflg        => ${@bnkflg},
				      p_eacbnk        => ${@eacbnk},
				      p_eaccty        => ${@eaccty},
				      p_trsdsp        => ${@trsdsp},
				      p_retcod        => ${@retcod},
				      p_errmsg        => ${@errmsg},
				      p_reqnbr        => ${@reqnbr},
				      p_oprdat        => ${@oprdat},
				      p_trs_status    => ${@trs_status},
				      p_confirm_date  => to_date(${@confirm_date}, 'yyyy-mm-dd'),
				      p_submit_date   => to_date(${@submit_date}, 'yyyy-mm-dd'),
				      p_manual_flag   => ${@manual_flag},
				      p_user_id       => ${/session/@user_id},
				      p_bank_id       => ${/session/@bank_id}
				  );
				end;
        	]]></bm:update-sql>
        </bm:operation>
    </bm:operations>
    <!--         <bm:data-filters>
        <bm:data-filter name="company_id" enforceOperations="query" expression="(t1.company_id=${/session/@company_id} or t1.company_id is null)"/>
    </bm:data-filters> -->
    <bm:query-fields>
        <bm:query-field name="write_off_flag_display" queryExpression="write_off_flag_display=${@write_off_flag_display}"/>
        <bm:query-field name="bp_name" queryExpression="t1.bp_name=${@bp_name}"/>
        <bm:query-field name="contract_number" queryExpression="t1.contract_number=${@contract_number}"/>
        <bm:query-field name="dbtacc" queryExpression="dbtacc=${@dbtacc}"/>
        <bm:query-field name="trs_status" queryExpression="trs_status=${@trs_status}"/>
        <bm:query-field name="due_date_f" queryExpression="t1.eptdat &gt;= to_date(${@due_date_f},&apos;yyyy-mm-dd&apos;)"/>
        <bm:query-field name="due_date_t" queryExpression="t1.eptdat &lt;= to_date(${@due_date_t},&apos;yyyy-mm-dd&apos;)"/>
        <!--  <bm:query-field name="due_date" dataType="java.lang.Date"  queryExpression="t1.due_date &lt;=${@due_date}"/> -->
        <bm:query-field name="cf_item" queryExpression="cf_item=${@cf_item}"/>
        <bm:query-field name="interface_id" queryExpression="interface_id in ${:@interface_id}"/>
    </bm:query-fields>
</bm:model>
