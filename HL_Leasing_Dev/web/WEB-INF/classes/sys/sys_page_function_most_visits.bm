<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: DJ  
    $Date: 2013-4-14 下午02:19:46  
    $Revision: 1.0  
    $Purpose: 
-->
<bm:model xmlns:bm="http://www.aurora-framework.org/schema/bm">
    <bm:operations>
     <!--   <bm:operation name="query">
            <bm:query-sql><![CDATA[
            	select function_code,function_name from
				(
					select v.function_code, v.function_name
					  from sys_page_favorites_v v
					 where v.user_id = ${/session/@user_id}
					   and v.role_id = ${/session/@role_id}
					   and v.company_id = ${/session/@company_id}
					order by v.hit_number desc 
				)
				where rownum <= 20
			]]></bm:query-sql>
        </bm:operation> -->
		<bm:operation name="query">
            <bm:query-sql><![CDATA[
select function_code,function_name
  from (select function_code,function_name
          from (SELECT distinct v.function_code,
                                v.function_name,
                                v.hit_number
                  FROM sys_page_favorites_v v
                 WHERE exists (select 1
                          from sys_role_menu_v l,
                               sys_role_menu_v p1,
                               sys_role_menu_v p2
                         where l.parent_menu_id = p1.menu_id
                           and p1.parent_menu_id = p2.menu_id
                           and l.function_id = v.function_id
                           and l.role_id = v.role_id)
                   and v.user_id = ${/session/@user_id}
					   and v.role_id = ${/session/@role_id}
					   and v.company_id = ${/session/@company_id})
         ORDER BY hit_number DESC)
 WHERE rownum <= 20
			]]></bm:query-sql>
        </bm:operation>
    </bm:operations>
</bm:model>
