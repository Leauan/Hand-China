<?xml version="1.0" encoding="UTF-8"?>
<bm:model xmlns:bm="http://www.aurora-framework.org/schema/bm">
    <bm:operations>
        <bm:operation name="query">
            <bm:query-sql><![CDATA[
                SELECT
                    record_id,
                    hd_id,
                    bp_id,
                    (SELECT bp_name FROM hls_bp_master WHERE bp_id = t1.bp_id
                    ) bp_name,
                    MONTH,
                    last_month_count,
                    modify_count,
                    last_modify_count,
                    last_month_count + NVL(modify_count,0)  - NVL(last_modify_count,0) final_count,
                    linkage_desc,
                    linkage_desc linkage_desc_n,
                    status,
                    (SELECT
                        CODE_VALUE_NAME
                    FROM
                        Sys_Code_Values_v
                    WHERE
                        CODE      ='CON_CHANGE_REQ_STATUS' AND
                        CODE_VALUE=t1.status
                    ) status_n,
                    instance_id,
                    t1.confirm_flag,
                    t1.confirm_user_id,
                    t1.mod_count,
                    t1.last_mod_count,
                    linkage_rate ,
                    linkage_amount,
                    cars_num
                FROM
                    hls_linkage_bp_month t1
                WHERE
                    t1.record_id =${@record_id}
            ]]></bm:query-sql>
        </bm:operation>
        <bm:operation name="execute">
            <bm:update-sql><![CDATA[
                BEGIN
                    hls_linkage_bp_number_pkg.agent_linkage_wfl_start(p_record_id =>${@record_id} , 
                                                      p_user_id =>${/session/@user_id} 
                                                      );
                END;
            ]]></bm:update-sql>
        </bm:operation>
    </bm:operations>
</bm:model>
