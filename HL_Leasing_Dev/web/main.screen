<?xml version="1.0" encoding="UTF-8"?>
<a:screen xmlns:c="aurora.application.action" xmlns:p="uncertain.proc" xmlns:a="http://www.aurora-framework.org/application" trace="true">
    <a:init-procedure>
        <a:model-query defaultWhereClause="v.menu_type=&apos;MENU&apos; and v.parent_menu_id is null" fetchAll="true" model="sys.sys_page_menu" rootPath="main_menu_list"/>
        <a:model-query defaultWhereClause="v.menu_type=&apos;MENU&apos; and v.parent_menu_id is not null" fetchAll="true" model="sys.sys_page_menu" rootPath="sub_menu_list"/>
        <a:model-query defaultWhereClause="v.menu_type = &apos;FUNCTION&apos;" fetchAll="true" model="sys.sys_page_menu" rootPath="menu_function_list"/>
        <a:model-query fetchAll="true" model="sys.sys_page_function_favorites" rootPath="favorites_list"/>
        <a:model-query fetchAll="true" model="sys.sys_page_function_last_visits" rootPath="last_visits_list"/>
        <a:model-query fetchAll="true" model="sys.sys_page_function_most_visits" rootPath="most_visits_list"/>
        <a:model-query fetchAll="true" model="sys.sys_page_home_page" rootPath="home_page_list"/>
        <a:model-query model="basic.sys_session_info" rootPath="mainPage_session_record"/>
        <a:model-query fetchAll="true" model="basic.hls_get_sys_parameter_tab_function_value" rootPath="hls_get_sys_parameter_open_tab_path"/>
    </a:init-procedure>
    <a:view template="main">
        <a:link id="BmLink_MainScreen_functionHit" model="sys.sys_page_function_visit" modelaction="update"/>
        <a:link id="BmLink_MainScreen_AddFunctionFavorite" model="sys.sys_page_function_favorites" modelaction="insert"/>
        <a:link id="BmLink_MainScreen_DelFunctionFavorite" model="sys.sys_page_function_favorites" modelaction="delete"/>
        <a:link id="BmLink_MainScreen_SetHomePage" model="sys.sys_page_home_page" modelaction="update"/>
        <a:link id="PageLink_MainScreen_LoginTimeout" url="${/request/@context_path}/login_timeout.screen"/>
        <a:link id="pageLink_update_self_password" url="${/request/@context_path}/update_self_password.screen"/>
        <a:link id="pageLink_show_session" url="${/request/@context_path}/main_show_session.screen"/>
        <a:link id="theme_select_link" url="${/request/@context_path}/theme_select.screen"/>
        <a:link id="gloabl_tab_iframe_link" url="${/request/@context_path}/global_tab_iframe.screen"/>
        <style><![CDATA[
             html,body {
                padding:0px;
                overflow:hidden
            }
            .solidblockmenu A {COLOR: #000; TEXT-DECORATION: none}
            .solidblockmenu A:link { COLOR: #000; TEXT-DECORATION: none}
            .solidblockmenu A:visited {COLOR: #000; TEXT-DECORATION: none}
            .solidblockmenu A:active {COLOR: #000;TEXT-DECORATION: none}
            .solidblockmenu A:hover {COLOR: #000;TEXT-DECORATION: none}
            /** Head Menu **/
            .solidblockmenu{
                margin: 0px;
                padding: 0px;
                float: left;
                font-size:14px;
                font-weight:bold;
                line-height:34px;
                -webkit-border-radius:4px;
                border-radius:4px;
                -moz-box-shadow: 0px 1px 3px rgba(0,0,0,0.3);
                -webkit-box-shadow: 0px 1px 3px rgba(0,0,0,0.3);
                box-shadow: 0px 1px 3px rgba(0,0,0,0.3);
                width:100%;
            }
            .solidblockmenu li{
                display: inline;
                margin: 0px;
                padding: 0px;
            }
            .solidblockmenu li a{
                text-align:center;
                float: left;
                width:75px;
                overflow:hidden;
                color: white;
                height:36px;
                text-decoration: none;
                background: transparent url(images/globalnav.png) -102px 0px no-repeat;
            }
            
            .solidblockmenu .first a{
                background-position: 0px 0px;
            }
            .solidblockmenu .search {
                float:left;
                width:100px;
                padding-left:12px;
                padding-right:8px;
                height:36px;
                background: transparent url(images/global.png) 100% 0px repeat;
            }
            
            .solidblockmenu .searchbox {
                width:85px;
                height:16px;
                margin-top:7px;
                padding:2px 10px;
                font-weight:normal;
                background: transparent url(images/globalsearch_field.png) 0px -20px no-repeat;
            }
            .solidblockmenu .s_active {
                background-position:0px -20px;
            }
            .searchbox input {
                height:18px;
                width:70px;
                border:none;
                background-color:transparent;
            }
            
            .solidblockmenu .menu_btn {
                position:absolute;
                text-align:center;
                width:75px;
                height:36px;
                text-decoration: none;
                background: transparent url(images/global.png) 100% 0px repeat;
            }
            
            .solidblockmenu .middle {
                margin-left:10px;
                margin-right:10px;
                height:36px;
                background: transparent url(images/global.png) 100% 0px repeat;
            }
            
            .solidblockmenu .last {
                text-align:center;
                position:absolute;
                width:10px;
                height:36px;
                text-decoration: none;
                background: transparent url(images/globalnav.png) -296px 0px no-repeat;
            }
            .solidblockmenu  a.active,.solidblockmenu  a.active:hover{
                color:#13a3f7;
            }
            /**
            .solidblockmenu li a:hover{
                background-position:-102px -72px;
            }
            
            
            .solidblockmenu .first a:hover{
                background-position:0px -72px;
            }
            .first  a.active,.first  a.active:hover{
                background-position:0px -108px;
            }
            **/
            .custTree .node-line, .custTree .clip-join, .custTree .clip-joinBottom{
                background:none;
            }
            .custTree .clip-minusTop,.custTree .clip-minusBottom,.custTree .clip-minus {
                background:url(${/request/@context_path}/images/minus.gif) no-repeat 50%;
            }
            .custTree .clip-plusTop,.custTree .clip-plusBottom,.custTree .clip-plus {
                background:url(${/request/@context_path}/images/plus.gif) no-repeat 50%;
            }
            .custTree .item-node {
                padding-top:5px;
            }
            .custTree .icon-node{
                background:url(${/request/@context_path}/images/chart_bar.png) no-repeat 50%;
            }
            .subMenu .menu {
                display:none;
                padding:10px;
                position:absolute;
                border-radius:4px;
                background-color:#fff;
                border:1px solid #ccc;
                -webkit-border-radius:4px;
                -moz-box-shadow: 0px 4px 16px rgba(0,0,0,0.5);
                -webkit-box-shadow: 0px 4px 16px rgba(0,0,0,0.5);
                box-shadow:0px 4px 16px rgba(0,0,0,0.5);
                filter: progid:DXImageTransform.Microsoft.Shadow(color='#969696', Direction=180, Strength=4);
                z-index:1000;
            }
            
            
            .menu A {COLOR: #333; TEXT-DECORATION: none}
            .menu A:link { COLOR: #333; TEXT-DECORATION: none}
            .menu A:visited {COLOR: #333; TEXT-DECORATION: none}
            .menu A:active {COLOR: #333;TEXT-DECORATION: none;}
            .menu A:hover {COLOR: #2f7fd4;TEXT-DECORATION: underline}
            
            .menu ul {
                float:left;
                margin-right:5px;
                margin-bottom:10px;
            }
            .menu .head{
                font-size:15px;
                font-weight:bold;
                line-height:30px;
                border-bottom:1px solid #ccc;
                margin-right:0px;
                margin-bottom:10px;
                background:none;
                padding:0px;
            }
            .menu li{
                line-height:25px;
                margin-right:25px;
                font-size:13px;
                padding: 0px;
                padding-left:10px;
                background:#fff url(${/request/@context_path}/images/right.gif) -5px 5px no-repeat;
            }
            
            .searchBox {
                background:#fff url(${/request/@context_path}/images/search.png) 2px 2px no-repeat;
                padding-left:5px;
            }
            
            .head_c{
                font-size:15px;
                font-weight:bold;
                line-height:30px;
                border-bottom:1px solid #ccc;
                margin-right:6px;
                margin-bottom:10px;
                background:none;
                padding:0px;
            }
            
            #sidemenu {
                width:150px;
                position:absolute;
                z-index:10;
                top:150px;
                left:-140px;
            } 
            #sidemenu div s {                
                display: inline-block;
                float: left;
                width: 28px;
                height: 30px;
                background: url(${/request/@context_path}/images/blue_bg.gif) 0 -96px;
                vertical-align: middle;
            }
            #sidemenu div p {                
                display: inline-block;
                float: left;
                width: 12.15px;
                height: 30px;
                vertical-align: middle;
            }
            
            #sidemenu div.home a p {
                background-position: -0px -192px;
            }
            
            #sidemenu div.home a s {
                background-position: -65px -0px;
            }
            #sidemenu div.home a:hover s {
                background-position: -33px -0px;
            }
            #sidemenu div.message a s {
                background-position: -65px -32px;
            }
            #sidemenu div.message a:hover s {
                background-position: -33px -32px;
            }
            #sidemenu div.vender a s {
                background-position: -65px -64px;
            }
            #sidemenu div.vender a:hover s {
                background-position: -33px -64px;
            }
            #sidemenu div.introduction a s {
                background-position: -65px -98px;
            }
            #sidemenu div.introduction a:hover s {
                background-position: -33px -98px;
            }
            #sidemenu div.rtntop a s {
                background-position: -65px -130px;
            }
            #sidemenu div.rtntop a:hover s {
                background-position: -33px -130px;
            }
            #sidemenu div.shopcart a s {
                background-position: -65px -162px;
            }
            #sidemenu div.shopcart a:hover s {
                background-position: -33px -162px;
            }
            
            #sidemenu div {
                margin-top:2px;                
            }
            #sidemenu div a {
                display:block;
                width:150px;
                height:30px;
                background-color:#A9D4FF;
                text-decoration:none;
                cursor:pointer;
                overflow:hidden
            }
            
            #sidemenu div a:hover{
                background-color:#2789E0;
            }
            
            #sidemenu div span{
                display: inline-block;
                float: left;
                width: 100%;
                height: 30px;
                color: white;
                text-align:center;
                line-height: 32px;
                overflow: hidden;
            }
            
            
            
            
			#main_message_tip{ 
				position: absolute; 
				right: 0px; 
				bottom: 0px; 
				height: 0px; 
				width: 180px; 
				border: 1px solid #CCCCCC; 
				background-color: #eeeeee; 
				padding: 1px; 
				overflow: hidden; 
				display: none; 
				font-size: 12px; 
				z-index: 10; 
			}			 
			#main_message_tip p{ 
				padding: 6px; 
			}			 
			#main_message_tip h1, #detail h1{ 
				font-size: 14px; 
				height: 25px; 
				line-height: 25px; 
				background-color: #0066CC; 
				color: #FFFFFF; 
				padding: 0px 3px 0px 3px; 
				filter: Alpha(Opacity=100); 
			}			 
			#main_message_tip h1 a, #detail h1 a{ 
				float: right; 
				text-decoration: none; 
				color: #FFFFFF; 
			}        
			  #footer{
			     position:absolute;
			     bottom:0;
			     width:100%;
			     height:20px;
			     background-color:#DDDDDD;
			     z-index:1001;
			 }
			 #footer  #foot{
			      font-size:14px;
                font-weight:normal;
                line-height:15px;
                border-bottom:1px solid #ccc;
                margin-right:0px;
                margin-bottom:5px;
                background:none;
                padding:0px;
				text-align:center;
                vertical-align:middle;
                color: #000000; 
                z-index:1001;
			 }
           #footer  #foot #aa{color:#000000;}

        ]]></style>
        <script><![CDATA[
            var global_tab_flag = '${/model/hls_get_sys_parameter_open_tab_path/record/@global_tab_flag}';
            var frameId = 0;
            
            function updatePassword() {
            
                new Aurora.Window({
                    id: 'update_password_window',
                    url: $('pageLink_update_self_password').getUrl(),
                    title: '修改密码',
                    closeable: true,
                    draggable: false,
                    height: 200,
                    width: 260
                });
            }
            
            function mainScreen_doOperation(o_type) {
                var function_code = Aurora.getCookie('FUNCTION_CODE');
                if (Ext.isEmpty(function_code)) {
                    Aurora.showMessage('提示', '页面不存在');
                    return;
                }
            
                var Urlconfig = {
                    'addFavorite': 'BmLink_MainScreen_AddFunctionFavorite',
                    'delFavorite': 'BmLink_MainScreen_DelFunctionFavorite',
                    'setHomePage': 'BmLink_MainScreen_SetHomePage'
                };
            
                var link = Urlconfig[o_type];
                var url = $(link).getUrl();
            
                Aurora.request({
                    url: url,
                    para: {
                        function_code: function_code
                    },
                    scope: this,
                    success: function() {
                        Aurora.showMessage('提示', '操作成功！刷新页面或者下次登录时生效');
                    }
                });
            }
            
            function mainJumpUrl(url, func_name) {
                hideCurrentMenu();
                Aurora.setCookie('TARGETURL', url, 0.5);
                if (global_tab_flag == 'Y') {
                    url = url.replaceAll('&', '%26');
                    openTab($('gloabl_tab_iframe_link').getUrl() + '?frame_id=' + (++frameId) + '&screen=' + url, func_name);
                } else {
                    document.getElementById('mainFrame').src = url;
                }
            }
            
            function openTab(url, prompt) {
                var tabArr = $('mainTab').items;
                if (tabArr && tabArr.length && tabArr.length > 0) {
                    for (var i = 0;i < tabArr.length;i++) {
                        if (tabArr[i].prompt == prompt) {
                            $('mainTab').selectTab(i);
                            var frameIDReg = /frame_id=\d+\&/;
                            var frameIDStrArr = tabArr[i].ref.match(frameIDReg);
                            if (frameIDStrArr && frameIDStrArr[0]) {
                                var frameID = frameIDStrArr[0].replace('frame_id=', '').replace('&', '');
                                document.getElementById('tabFrame' + frameID).src = window['frame_url_' + frameID];
                            }
                            return;
                        }
                    }
                }
                $('mainTab').openTab(url, prompt);
            }
            
            function mainScreen_hitPage(function_code) {
                if (Ext.isEmpty(function_code)) {
                    return;
                }
                Aurora.setCookie('FUNCTION_CODE', function_code, 0.5);
            
                Aurora.request({
                    url: '${/request/@context_path}/autocrud/sys.sys_page_function_visit/update',
                    para: {
                        function_code: function_code
                    },
                    scope: this,
                    success: function(res) {
                        var mainServiceName = res.result['main_service_name'];
                        var layout_code = res.result['layout_code'];
                        if (Ext.isEmpty(mainServiceName)) {
                            Aurora.showMessage('提示', '功能不存在');
                            return;
                        } else {
                            if (layout_code) {
                                mainServiceName = mainServiceName + '?layout_code=' + layout_code + '&function_code=' + function_code;
                            }
                            var func_name = res.result['function_name'];
                            mainJumpUrl(mainServiceName, func_name);
                        }
                    }
                });
            }
            
            function mainScreen_refreshMainContent() {
                //如果cookie中未找到，则跳转到首页
                var function_code = Aurora.getCookie('FUNCTION_CODE');
                if (Ext.isEmpty(function_code)) {
                    goToHomePage();
                } else {
                    mainScreen_hitPage(function_code);
                }
            }
            
            function mainJumpCode(function_code) {
                if (!Ext.isEmpty(function_code)) {
                    mainScreen_hitPage(function_code);
                }
            }
            
            function goToHomePage() {
                var function_code = '${/model/home_page_list/record/@function_code}';
                if (Ext.isEmpty(function_code)) {
                    function_code = 'SYS_HOME_PAGE';
                }
                mainJumpCode(function_code);
            }
            
            function doSearch() {
                var function_code = (document.getElementById('sp-searchtext').value).toUpperCase();
                if (!function_code) {
                    return;
                } else {
                    mainScreen_hitPage(function_code);
                }
            
            }
            
            function hideSubmenu(code) {
                document.getElementById('SUBMENU_' + code).style.display = 'none';
                window.subModel = null;
            }
            
            function hideCurrentMenu() {
                if (window.subModel) {
                    hideSubmenu(window.subModel);
                }
            }
            
            function mainSetTargeturl(code) {
                if (window.currentModel && window.currentModel != code) {
                    window.subModel = null;
                    Ext.get('M_MENU_' + window.currentModel).child('a').removeClass('active');
                    document.getElementById('SUBMENU_' + window.currentModel).style.display = 'none';
                }
                window.currentModel = code;
                Ext.get('M_MENU_' + code).child('a').addClass('active');
            
                if (window.subModel) {
                    hideSubmenu(code);
                } else {
                    window.subModel = code;
                    var x = Ext.get('M_MENU_' + code).child('a').getXY()[0];
                    Ext.get('SUBMENU_' + code).setLeft(x - 10);
                    Ext.get('SUBMENU_' + code).fadeIn();
                    if (document.getElementById('SUBMENU_' + code).offsetHeight > 600) {
                        document.getElementById('SUBMENU_' + code).style.height = "600px";
                        document.getElementById('SUBMENU_' + code).style.overflow = "auto";
                    } else {
                        document.getElementById('SUBMENU_' + code).style.height = "auto";
                    }
                }
            }
            
            function show_tool_tip(e, code) {
                $A.ToolTip.show(e, code);
            }
            
            function hide_tool_tip(e) {
                $A.ToolTip.hide(e);
            }
            
            function showSessionMessage() {
                new Aurora.Window({
                    id: 'main_show_session',
                    url: $('pageLink_show_session').getUrl(),
                    title: '查看SESSION',
                    params: {
                        jsid: Aurora.getCookie('JSID')
                    },
                    width: 420,
                    height: 550
                });
            }
            
            function exitSystem() {
                Aurora.request({
                    url: 'logout.svc',
                    para: {},
                    success: function() {
                        try {
                            if (window.opener) {
                                opener.location.href = 'login.screen';
                                window.close();
                            } else {
                                location.href = 'login.screen';
                            }
                        } catch (e) {
                            window.close();
                        }
                    },
                    scope: this
                });
            }
            
            function showTheme() {
                var url = $('theme_select_link').getUrl();
                var themeWindow = new Aurora.Window({
                    id: 'theme_window',
                    url: url,
                    title: '皮肤选择',
                    height: 226,
                    width: 580
                });
            }
            
            // function to_do_interval() {
                // $('to_do_list_count_ds').query();
            // }
            
            //待办提醒窗口  20170223 jianglei
            //setInterval('to_do_interval()', 1000 * 60 * 1);
            //var con_time = new Date();
            
            
            
            // function to_do_load() {
                // var to_do_count_id = $('to_do_list_count_ds');
                // var record = to_do_count_id.getAt(0);
                // //var max_date = record.get('max_date');
                // var max_date = getDate(record.get('max_date_format'));
                // //alert(1+con_time)
                // //alert(2+max_date)
                // if (max_date <= con_time) {
                    // //start('up');//测试用
                // } else {
                    // con_time = max_date;
                    // start('up');
                // }
            
            // }
            
            
            function getDate(strDate) {
                var date = eval('new Date(' + strDate.replace(/\d+(?=-[^-]+$)/, function(a) {
                    return parseInt(a, 10) - 1;
                }).match(/\d+/g) + ')');
                return date;
            }
            
            
            
            window.onload = function() {
                var divTip = document.createElement("div");
                divTip.id = "main_message_tip";
                divTip.innerHTML = "<h1><a href='javascript:void(0)' onclick='start()'>×</a>New message</h1><p><a href='javascript:void(0)' onclick='showwin()'><p style='font-size:16px;'>您有新的待办事项！</p></a></p>";
                divTip.style.height = '0px';
                divTip.style.bottom = '0px';
                divTip.style.position = 'fixed';
                document.body.appendChild(divTip);
            };
            
            var handle;
            
            function start(param) {
                var obj = document.getElementById("main_message_tip");
                // if (parseInt(obj.style.height) == 0) {
                // obj.style.display = "block";
                // //handle = setInterval("changeH('up')", 20);
                // obj.style.height = "100px";
                // } else {
                // //handle = setInterval("changeH('down')", 20);
                // obj.style.display = "none";
                // obj.style.height = "0px";
                // }
                if (param == 'up') {
                    obj.style.display = "block";
                    obj.style.height = "160px";
                    obj.style.width = "240px";
                } else {
                    obj.style.display = "none";
                    obj.style.height = "0px";
                }
            }
            
            //页面浮出效果，暂不用
            
            
            function changeH(str) {
                var obj = document.all ? document.all["main_message_tip"] : document.getElementById("tip");
                if (str == "up") {
                    if (parseInt(obj.style.height) > 100) {
                        clearInterval(handle);
                    } else {
                        obj.style.height = (parseInt(obj.style.height) + 8).toString() + "px";
                    }
                }
                if (str == "down") {
                    if (parseInt(obj.style.height) < 8) {
                        clearInterval(handle);
                        obj.style.display = "none";
                    } else {
                        obj.style.height = (parseInt(obj.style.height) - 8).toString() + "px";
                    }
                }
            }
            
            var role_code = '${/model/mainPage_session_record/record/@role_code}';
            
            
            function showwin() {
                start(); //隐藏消息窗口
                //总经理、财务部部长 跳转到：待办事项批量审批
                //alert(role_code);
                if (role_code == '0001' || role_code == '0511') {
                    mainScreen_hitPage('WFL5120');
                } else {
                    mainScreen_hitPage('ZJWFL5110');
                }
            }
        ]]></script>
        <a:dataSets>
            <a:dataSet id="to_do_list_count_ds" model="zjwfl.ZJWFL5110.zj_wfl_to_do_max_date">
                <a:fields>
                    <a:field name="max_date"/>
                </a:fields>
                <a:events>
                    <!-- <a:event name="load" handler="to_do_load"/> --><![CDATA[
                    
                    
                ]]></a:events>
            </a:dataSet>
        </a:dataSets>
        <div id="main_menu_id" style="padding:2px 2px 0px 2px;">
            <table id="main" border="0" cellPadding="0" cellSpacing="0" style="width:100%;height:100%;">
                <tbody>
                    <tr>
                        <td>
                            <ul id="solidblockmenu" class="solidblockmenu">
                                <a:freeMarker><![CDATA[
                                     <#if model.getObject("/model/main_menu_list").getChilds()??>
                                        <#list model.getObject("/model/main_menu_list").getChilds() as item>
                                            <#if item_index == 0>
                                                <li id="M_MENU_${item.getString('function_code')}" class="first">
                                            <#else>
                                                <li id="M_MENU_${item.getString('function_code')}" >
                                            </#if>
                                            
                                            <#if item.getString('parent_menu_id')??>
                                                <a hidefocus="true" href="#" >${(item.getString('function_name')!"")?html}</a>
                                            <#else>
                                                <a hidefocus="true" onclick="javascript:mainSetTargeturl('${item.getString('function_code')}');" href="javascript:void(0)">${(item.getString('function_name')!"")?html}</a>
                                            </#if>
                                            
                                            </li> 
                                        </#list>         
                                    </#if>
                                    ]]></a:freeMarker>
                                <li>
                                    <div class="search">
                                        <div id="search_box" class="searchbox">
                                            <input name="function_code" id="sp-searchtext" accessKey="s" autocomplete="off" type="text"/>
                                        </div>
                                    </div>
                                </li>
                                <div class="middle"/>
                                <li>
                                    <div class="last" style="top:2px;right:2px;"/>
                                </li>
                                <li>
                                    <div style="font-weight:normal;font-size:8px;position:absolute;text-align:right;color:#000;top:2px;right:55px;">
                                        <!--<span><![CDATA[您好，]]></span>-->
                                        <span><![CDATA[${/model/mainPage_session_record/record/@user_desc}-]]></span>
                                        <span><![CDATA[${/model/mainPage_session_record/record/@role_name}]]></span>
                                    </div>
                                </li>
                                <li>
                                    <div style="font-weight:normal;font-size:14px;position:absolute;text-align:right;color:#000;top:2px;right:25px;">
                                        <a href="javascript:exitSystem();" style="background: url(${/request/@context_path}/images/application_exit.png) no-repeat;margin-top:5px;width:25px;"/>
                                    </div>
                                </li>
                                <!--
                                <li>
                                    <div class="menu_btn" style="top:10px;right:23px;">
                                        <div>
                                            <a href="javascript:exitSystem();"><![CDATA[${l:L.EXIT_SYSTEM}]]></a>
                                        </div>
                                    </div>
                                </li>
                                <li>
                                    <div class="menu_btn" style="top:10px;right:98px;">
                                        <div>
                                            <a href="javascript:void(0);" onclick="javascript:goToHomePage();"><![CDATA[首页]]></a>
                                        </div>
                                    </div>
                                </li>
                                -->
                            </ul>
                        </td>
                    </tr>
                    <tr>
                        <td id="subMenu" class="subMenu">
                            <div style="position:relative">
                                <a:freeMarker><![CDATA[
                                    <#if model.getObject("/model/main_menu_list").getChilds()??>
                                        <#list model.getObject("/model/main_menu_list").getChilds() as main_menu>
                                            <div class="menu" id="SUBMENU_${main_menu.getString('function_code')}">
                                            
                                                <#if model.getObject("/model/sub_menu_list").getChilds()??>
                                                    <#list model.getObject("/model/sub_menu_list").getChilds() as sm>
                                                        <#if sm.getString('parent_menu_id') == main_menu.getString('menu_id')>
                                                        	<div style="float:left">
		                                                    <div class="head_c">${(sm.getString('function_name')!"")?html}</div>
                                                            <#if (sm.getString('sub_menu_count')?number gt 19)>
                                                    			<ul style="width:136px;height:460px;overflow:auto">
                                                    		<#else>
                                                    			<ul style="height:auto;overflow:auto">
                                                    		</#if>
                                                            <#if model.getObject("/model/menu_function_list").getChilds()??>
                                                                <#list model.getObject("/model/menu_function_list").getChilds() as function>
                                                                    <#if function.getString('parent_menu_id') == sm.getString('menu_id') >
                                                                        <li>
                                                                            <a onmouseout="javascript:hide_tool_tip(this);" onmouseover="javascript:show_tool_tip(this,'${(function.getString('function_code')!"")?html}');" hidefocus="true"  href="javascript:mainJumpCode('${function.getString('function_code')}')" >${(function.getString('function_name')!"")?html}</a>
                                                                        </li>
                                                                    </#if>
                                                                </#list>
                                                           		 </ul>  
                                                            </#if>
                                                            </div>
                                                        </#if>
                                                    </#list>
                                                </#if>
                                                
                                                <#if main_menu.getString('function_code')=='SYS_OPERATION'>
                                                    <ul>
                                                        <li class="head">操作</li>
                                                        <li><a hidefocus="true" href="javascript:void(0);" onclick="javascript:goToHomePage();">首页</a></li>
                                                        <li><a hidefocus="true" href="javascript:void(0);" onclick="javascript:mainScreen_doOperation('setHomePage');">设为首页</a></li>
                                                        <li><a hidefocus="true" href="javascript:void(0);" onclick="javascript:updatePassword();">修改密码</a></li>
                                                        <li><a hidefocus="true" href="javascript:void(0);" onclick="javascript:exitSystem();">退出系统</a></li>
                                                        <li><a hidefocus="true" href="javascript:void(0);" onclick="javascript:showTheme();">皮肤选择</a></li>
                                                        <li><a hidefocus="true" href="javascript:void(0);" onclick="javascript:showSessionMessage();">查看SESSION</a></li>
                                                    </ul>
                                                   <ul>    
                                                        <li class="head">最近访问</li>
                                                        <#if model.getObject("/model/last_visits_list").getChilds()??>
                                                            <#list model.getObject("/model/last_visits_list").getChilds() as par>
                                                                <li><a href="javascript:mainJumpCode('${par.getString('function_code')}')">${(par.getString('function_name')!"")?html}</a></li>
                                                            </#list>
                                                        </#if>
                                                    </ul>
                                                     <ul>
                                                        <li class="head">最多访问</li>
                                                        <#if model.getObject("/model/most_visits_list").getChilds()??>
                                                            <#list model.getObject("/model/most_visits_list").getChilds() as pam>
                                                                <li><a href="javascript:mainJumpCode('${pam.getString('function_code')}')">${(pam.getString('function_name')!"")?html}</a></li>
                                                            </#list>
                                                        </#if>
                                                    </ul> 
                                                </#if>
                                                
                                            </div>
                                        </#list>
                                    </#if>
                                ]]></a:freeMarker>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div id="footer">
            <table id="foot" border="0" cellPadding="0" cellSpacing="0" style="width:100%;">
                <!--  <thead>
                      <tr>
                        <td><![CDATA[联系我们]]></td>
                        <td><![CDATA[电话：021-5056-3050]]></td>
                        <td><![CDATA[地址：上海市浦东新区福山路388号越秀大厦2204室]]></td>
                    </tr> <![CDATA[
                    
                   
                ]]></thead> -->
                <!--  <tbody>
                     <tr>
                        <td><![CDATA[联系我们]]></td>
                        <td><![CDATA[邮编：200122]]></td>
                    </tr>
                    <tr>
                        <td/>
                        <td><![CDATA[网站： www.hongling.sh.cn]]></td>
                        <td><![CDATA[三菱商事 全资子公司]]></td>
                    </tr> <![CDATA[
                    
                    
                ]]></tbody> -->
                <tfoot>
                    <tr>
                        <td><![CDATA[ Hongling Financial Leasing Co.,Ltd. &nbsp;&nbsp;&nbsp; 沪ICP备12011971号]]></td>
                        <!-- <td>
                            <p>
							    <a><![CDATA[Hongling Financial Leasing Co.,Ltd.  沪ICP备12011971号]]></a>
                                <a id="aa" href="http://www.miibeian.gov.cn/state/outPortal/loginPortal.action;jsessionid=LI0OUm7iVTTLQgXbsXG3snGetEhSiYxYmiAINJCpfwWUeEYszurn!1316315234" ref="nofollow"><![CDATA[
 沪ICP备12011971号]]></a>
                            </p>
                        </td> -->
                        <!--  <td>
                            <p>
                                <a href="http://www.hongling.sh.cn/Personal%20information%20policy.html" ref="nofollow"><![CDATA[

个人信息保护政策]]></a>
                            </p>
                        </td>
                        <td>
                            <p>
                                <a href="http://www.hongling.sh.cn/Terms%20of%20use.html" ref="nofollow"><![CDATA[
网站利用条件]]></a>
                            </p>
                        </td>
                        <td><![CDATA[中文]]></td>
                        <td><![CDATA[日文]]></td>
                        <td><![CDATA[English]]></td> -->
                    </tr>
                </tfoot>
            </table>
        </div>
        <a:switch test="/model/hls_get_sys_parameter_open_tab_path/record/@global_tab_flag">
            <a:case value="Y">
                <a:tabPanel id="mainTab" marginHeight="0" marginWidth="0" style="margin-top:2px"/>
                <a:tabPanel id="foo" marginHeight="0" marginWidth="0" style="margin-top:2px"/>
            </a:case>
            <a:case value="Y">
                <tabPanel id="foo" height="80%" marginHeight="0" marginWidth="0" style="margin-top:2px"/>
            </a:case>
        </a:switch>
        <script language="javascript"><![CDATA[
            goToHomePage();
            
            
            //此处进行修改在确定系统超时的时候设置istimeout标记到cookie中
            
            function showlogin() {
                Aurora.setCookie('ISTIMEOUT', true, 0.05);
                new Aurora.Window({
                    id: 'login_timeout',
                    url: 'login_timeout.screen',
                    title: '系统已超时锁定，请解锁',
                    height: 280,
                    width: 400,
                    draggable: false,
                    closeable: false
                });
            }
            
            Aurora.manager.on('timeout', function() {
                showlogin();
                return false;
            });
            
            var jsid = Aurora.getCookie('JSID');
            
            window.scannJSID = {
                run: function() {
                    var jid = Aurora.getCookie('JSID');
                    if (jid != window.jsid) {
                        Ext.TaskMgr.stop(window.scannJSID);
                        var reloginWindow = new Aurora.Window({
                            id: 'relogin_window',
                            url: 'error_repeatlogin.screen',
                            title: '${l:PROMPT}',
                            closeable: false,
                            draggable: false,
                            height: 120,
                            width: 350
                        });
                    }
                },
                interval: 1000
            };
            Ext.TaskMgr.start(window.scannJSID);
            
            function initMainSize() {
                var tabFunctionHeight = 0;
                if ('${/model/hls_get_sys_parameter_open_tab_path/record/@global_tab_flag}' == 'Y') {
                    tabFunctionHeight = 30;
                }//modify by wutuansen 
                
                var topBarHeight = Ext.fly('main_menu_id').getHeight();
                var screenWidth = Aurora.getViewportWidth();
                var screenHeight = Aurora.getViewportHeight();
                var bottomHeight = screenHeight - topBarHeight - tabFunctionHeight;
                // document.cookie = "vh="+(bottomHeight);
                // document.cookie = "vw="+ (screenWidth);
                $A.setCookie('vh', bottomHeight);
                $A.setCookie('vw', screenWidth);
                if (global_tab_flag == 'Y') {
                    // var tagWidth = 150 + 5;
                    // //自适应宽度
                    // var marginWidth = 2;
                    // var marginHeight = 40;
                    var tagWidth = 150 ;
                    //自适应宽度
                    var marginWidth = -10;
                    var marginHeight = 40;
                    $('mainTab').setWidth(screenWidth - marginWidth);
                    $('mainTab').setHeight(screenHeight - marginHeight);
					document.getElementById('footer').style.display = "block";
                } else {
                    Ext.get('mainFrame').setHeight(bottomHeight);
                }
            }
            
            initMainSize();
            
            Ext.lib.Event.on(window, "resize", function() {
                initMainSize();
            }, this);
            
            Ext.onReady(function() {
                Ext.get('sp-searchtext').on('focus', function() {
                    Ext.get('search_box').addClass('s_active');
                }).on('blur', function() {
                    Ext.get('search_box').removeClass('s_active');
                }).on('keydown', function(e) {
                    if (e.keyCode == 13) {
                        doSearch();
                    }
                });
                Ext.getBody().on('click', function(el) {
                    var solidblockmenu = Ext.get('solidblockmenu');
                    var subMenu = Ext.get('subMenu');
                    if (solidblockmenu.contains(el.target) || solidblockmenu.dom === el.target) {
                        return;
                    }
                    if (subMenu.contains(el.target) || subMenu.dom === el.target) {
                        return;
                    }
                    hideCurrentMenu();
                });
            });
        ]]></script>
    </a:view>
</a:screen>
