<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: zhangxing5129  
    $Date: 2013-12-10 上午09:49:24  
    $Revision: 1.0  
    $Purpose: 
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application">
    <a:view>
        <a:link id="aut_desc_submit_link" model="aut.AUT110.aut_desc_submit" modelaction="batch_update"/>
        <!-- <a:link id="aut_desc_check_link" model="aut.AUT110.aut_desc_check" modelaction="update"/> -->
        <script><![CDATA[
            function aut_desc_confirm() {
                debugger;
                var node_sequence_num;
                var user_id;
                var parent_ds = $('zjwfl5110_toDoDs');
                var parent_records = parent_ds.getSelected();
                var current_ds = $('aut_desc_ds');
                var current_records = current_ds.getSelected();
                // if (current_records.length > 1) {
                // return;
                // }
                //var user_id = current_record.get('user_id');
                for (var i = 0;i < parent_records.length;i++) {
                    var node_sequence_num = parent_records[i].get('node_sequence_num');
                }
                //alert(node_sequence_num);
                for (var j = 0;j < current_records.length;j++) {
                    var user_id = current_records[j].get('user_id');
                }
                var current_record = current_records[0];
                var saveData = [];
                for (var i = 0;i < parent_records.length;i++) {
                    var parent_record = parent_records[i];
                    parent_record.set('transfer_user_id', current_record.get('user_id'));
                    parent_record.set('_status', 'update');
                    saveData.push(parent_record.data);
                }
                Aurora.showConfirm('${l:PROMPT}', '${l:DOCUMNET_SUBMIT_CONFIRM}', function() {
                    //var data = ds.getJsonData(true);
                    Aurora.request({
                        url: $('aut_desc_submit_link').getUrl(),
                        //传进来的参数
                        para: saveData,
                        success: function(args) {
                            $('${/parameter/@winId}').close();
                            $('zjwfl5110_toDoDs').query();
                            Aurora.SideBar.show({
                                msg: '操作成功',
                                duration: 2000
                            });
                        },
                        failure: function(args) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        error: function(args) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        scope: this
                    });
                }, function() {
                    Aurora.Masker.unmask(Ext.getBody());
                });
            }
        ]]></script>
        <a:dataSets>
            <a:dataSet id="aut_desc_query_ds">
                <!-- <a:fields>
                    <a:field name="sequence_num"/>
                    <a:field name="node_desc" lovGridHeight="300" lovHeight="450" lovService="aut.AUT110.aut_admin_sys_user_lov" lovWidth="500" prompt="用户">
                        <a:mapping>
                            <a:map from="sequence_num" to="sequence_num"/>
                            <a:map from="node_desc" to="node_desc"/>
                        </a:mapping>
                    </a:field>
                </a:fields> --><![CDATA[
                
                
                
                
                
                
            ]]></a:dataSet>
            <a:dataSet id="aut_desc_ds" autoQuery="true" model="aut.AUT110.aut_allocation_desc" pageSize="20" queryDataSet="aut_desc_query_ds" queryUrl="${/request/@context_path}/autocrud/aut.AUT110.aut_allocation_desc/query?user_id=${/parameter/@user_id}" selectable="true" selectionModel="single">
                <a:fields>
                    <a:field name="description"/>
                    <a:field name="user_name"/>
                    <a:field name="user_id"/>
                </a:fields>
            </a:dataSet>
        </a:dataSets>
        <a:screenBody>
            <a:screenTopToolbar>
                <a:screenTitle/>
                <a:gridButton click="aut_desc_confirm" text="确认分配"/>
            </a:screenTopToolbar>
            <a:grid bindTarget="aut_desc_ds" marginHeight="300" navBar="true" width="650">
                <a:columns>
                    <a:column name="user_name" prompt="审批用户" width="300"/>
                    <a:column name="description" prompt="描述" width="300"/>
                </a:columns>
            </a:grid>
        </a:screenBody>
    </a:view>
</a:screen>
