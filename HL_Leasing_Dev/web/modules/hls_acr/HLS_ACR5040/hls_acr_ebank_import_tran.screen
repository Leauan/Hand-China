<?xml version="1.0" encoding="UTF-8"?>
<a:screen xmlns:a="http://www.aurora-framework.org/application" customizationEnabled="true" trace="true">
    <a:init-procedure>
        <a:model-query model="basic.hls_fnd_attribute_sequence" rootPath="header"/>
        <a:import-excel header_id="${/model/header/record/@header_id}" separator="," status_field="/parameter/@ImportSuccess" template_code="HLS_EBANK" user_id="${/session/@user_id}"/>
        <a:model-query defaultWhereClause="header_id=${/model/header/record/@header_id} and TEMPLATE_CODE = &apos;HLS_EBANK&apos;" model="basic.hls_fnd_attribute_status" rootPath="status"/>
    </a:init-procedure>
    <a:view>
        <a:link id="hls_acr_ebank_import_link" url="${/request/@context_path}/modules/hls_acr/HLS_ACR5040/hls_acr_ebank_input_detail.screen"/>
        <a:link id="acr_invoice_import_save_data_link" model="hls_acr.HLS_ACR5040.hls_acr_import_data_insert" modelaction="execute"/>
        <a:link id="hls_acr_ebank_enter_link_1" url="${/request/@context_path}/modules/hls_acr/HLS_ACR5040/hls_acr_ebank_input.screen"/>
        <script><![CDATA[
            function loadComplete() {
              //  alert('${/parameter/@output_id}');
              debugger;
                if ('${/model/status/record/@status}' == 'NEW') {
                    var param = {};
                    // var errorData = "";
                     var importFlag = true;
                    // param['session_id'] = '${/parameter/@session_id}';
                    // param['header_id'] = '${/model/header/record/@header_id}';
                    if (importFlag) {
                        Aurora.request({
                            url: $('acr_invoice_import_save_data_link').getUrl(),
                            para: {
                               header_id:'${/model/header/record/@header_id}',
                               output_id:'${/parameter/@output_id}'
                            },
                            success: function(res) {
                 // window.location.href = $('hls_acr_ebank_import_link').getUrl()+ '?output_id=' + '${/parameter/@output_id}' + '&function_code=' + 'HLS_ACR5040D' + '&function_usage=QUERY';
                                 var win = new Aurora.Window({
	                id: 'acr_invoice_create_invoice',
	                url: $('hls_acr_ebank_import_link').getUrl(),
	                 params:{
	                     output_id:'${/parameter/@output_id}',
	                     function_code:'HLS_ACR5040D',
	                     function_usage:'QUERY'
	                 },
	                title: '明细',
	                fullScreen:true
	            });  win.on('close',function(){
	                //contractDs_grid_query();
                  window.location.href = $('hls_acr_ebank_enter_link_1').getUrl()+ '?layout_code=' + 'HLS_ACR5030_HEADER' + '&function_code=HLS_ACR5040';
	            });
                            },
                            failure: function() { 
                            },
                            error: function() { 
                            },
                            scope: this
                        });
                    } else {
                        errorData = errorData.substr(0, errorData.length - 1);
                        Aurora.showMessage('${l:PROMPT}', '${l:VERIFY_INFORMATION}');
                    }
                }
            }
          Aurora.onReady(function() {
              loadComplete();
             });
        ]]></script>
    </a:view>
</a:screen>
