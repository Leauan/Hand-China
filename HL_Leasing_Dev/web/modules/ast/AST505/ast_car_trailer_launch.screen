<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: ZLF  
    $Date: 2014-11-13 下午3:07:30  
    $Revision: 1.0  
    $Purpose: 
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application">
    <a:view>
        <a:link id="ast_car_trailer_link" url="${/request/@context_path}/modules/ast/AST505/ast_lease_item_maintance.screen"/>
        <a:link id="ast_car_trailer_submit_link" model="ast.AST505.ast_car_trailer" modelaction="insert"/>
        <script><![CDATA[
            function back() {
                if (!Aurora.isEmpty('${/parameter/@winid}')) {
                    $('${/parameter/@winid}').close();
                } else {
                    $('trailer_launch_window').close();
                }
            }
            
            function trailer_launch() {
            
                Aurora.showConfirm('确认', '您确定提交拖车申请吗？', function() {
                    Aurora.Masker.mask($('${/parameter/@winid}').wrap, '正在操作......');
                    var data = $('ast_car_trailer_result_ds_2').getCurrentRecord().data;
                    data['item_detail_id'] = $('con_item_info_ds_2').getCurrentRecord().get('item_detail_id');
                    data['contract_id'] = '${/parameter/@contract_id}';
            
            
            
                    Aurora.request({
                        url: $('ast_car_trailer_submit_link').getUrl(),
                        para: data,
                        scope: this,
                        success: function() {
                            Aurora.SideBar.show({
                                msg: '提交成功....',
                                duration: 3000
                            });
                            Aurora.Masker.unmask($('${/parameter/@winid}').wrap);
                            $('${/parameter/@winid}').close();
                        },
                        error: function() {
                            Aurora.Masker.unmask($('${/parameter/@winid}').wrap);
                        },
                        failure: function() {
                            Aurora.Masker.unmask($('${/parameter/@winid}').wrap);
                        }
                    });
                });
            }
        ]]></script>
        <a:dataSets>
            <a:dataSet id="con505_contract_result_ds" autoPageSize="true" autoQuery="true" model="ast.AST505.con_contract_dun_for_query" queryUrl="${/request/@context_path}/autocrud/ast.AST505.con_contract_dun_for_query/query?contract_id=${/parameter/@contract_id}"/>
            <a:dataSet id="con_item_info_ds_2" autoCreate="true" autoQuery="true" model="ast.AST505.con_contract_item_v" queryUrl="${/request/@context_path}/autocrud/ast.AST505.con_contract_item_v/query?contract_id=${/parameter/@contract_id}"/>
            <a:dataSet id="ast_car_trailer_result_ds_2" model="ast.AST505.ast_car_trailer">
                <a:fields>
                    <a:field name="estimate_amount" required="true"/>
                    <a:field name="trailer_reason" required="true"/>
                </a:fields>
            </a:dataSet>
        </a:dataSets>
        <a:screenBody>
            <a:screenTopToolbar>
                <a:screenTitle/>
                <a:gridButton click="back" text="后退"/>
                <a:gridButton click="trailer_launch" text="提交"/>
            </a:screenTopToolbar>
            <a:form column="1" marginWidth="30" title="基本信息">
                <a:hBox>
                    <a:textField name="bp_name" bindTarget="con_item_info_ds_2" prompt="承租人" readOnly="true"/>
                    <a:textField name="item_frame_number" bindTarget="con_item_info_ds_2" prompt="车架号" readOnly="true"/>
                    <a:textField name="item_engine_number" bindTarget="con_item_info_ds_2" prompt="发动机号" readOnly="true"/>
                    <a:textField name="color_of_apprearance" bindTarget="con_item_info_ds_2" prompt="外观颜色" readOnly="true"/>
                </a:hBox>
                <a:hBox>
                    <a:numberField name="estimate_amount" bindTarget="ast_car_trailer_result_ds_2" prompt="拖车预估费" width="150"/>
                    <a:textField name="brand_dis" bindTarget="con_item_info_ds_2" prompt="品牌" readOnly="true"/>
                    <a:textField name="series_dis" bindTarget="con_item_info_ds_2" prompt="车系" readOnly="true"/>
                    <a:textField name="model_dis" bindTarget="con_item_info_ds_2" prompt="车型" readOnly="true"/>
                </a:hBox>
                <a:hBox>
                    <a:textArea name="trailer_reason" bindTarget="ast_car_trailer_result_ds_2" prompt="拖车原因" width="850"/>
                </a:hBox>
            </a:form>
            <a:grid id="ast505_con_contract_grid_ds" bindTarget="con505_contract_result_ds" marginHeight="300" marginWidth="30" navBar="true">
                <a:columns>
                    <a:column name="contract_number" align="center" lock="true" prompt="HLS.CONTRACT_NUMBER" width="150"/>
                    <a:column name="times" align="center" prompt="租赁期数" width="150"/>
                    <a:column name="due_date" align="center" prompt="预定收款日" renderer="Aurora.formatDate" width="150"/>
                    <a:column name="due_amount" align="right" prompt="预定收款金额" renderer="Aurora.formatMoney" width="120"/>
                    <a:column name="received_amount" align="right" prompt="已收款金额" renderer="Aurora.formatMoney" width="120"/>
                    <a:column name="balance_due_amount" align="right" prompt="未收款金额" renderer="Aurora.formatMoney" width="120"/>
                </a:columns>
            </a:grid>
        </a:screenBody>
    </a:view>
</a:screen>
