<?xml version="1.0" encoding="UTF-8"?>
<a:screen xmlns:a="http://www.aurora-framework.org/application">
    <a:init-procedure/>
    <a:view>
        <a:link id="gps_attachment_uploadFile_id" url="${/request/@context_path}/uploadFile.screen"/>
        <script><![CDATA[
        
        function receipt_attachment_upload(val,rec,name){
        	   return '<a href=javascript:open_upload_window('+rec.get('ast_car_gps_id')+')>附件上传</a>';
        	}
        	
		function open_upload_window(record_id){
		    	if(Aurora.isEmpty(record_id)) {
		    	    Aurora.showMessage('提示','请先保存再上传附件！');
		    	    return;
		    	}
        	    var url = $('gps_attachment_uploadFile_id').getUrl() + '?table_name=AST_CAR_GPS&header_id=' + record_id;
                var win = new Aurora.Window({
                    url: url,
                    title: '${l:HLS.SUPPORTING_DOCUMENT}',
                    id: 'gps_uploadFile_id',
                    width: 850,
                    height: 400
                });
                win.on('close', function() {
                });
        	}     
        	
        	function submitsuccessHandler(ds,res){
        	    ds.query();
        	}      	
        	
        	// function addHandler(ds,record,index) {
        	    // var con_record=$('con_item_info_ds').getCurrentRecord();
        	    // alert(con_record.get('gps_install_flag'));
        	    // if(Aurora.isEmpty(con_record.get('gps_install_flag')) ||con_record.get('gps_install_flag')=='N') {
        	        // Aurora.showMessage('提示','请先确认是否需安装GPS！');
        	        // ds.clear();
        	        // return;
        	    // }
        	    // if(Aurora.isEmpty(con_record.get('arrange_flag'))||con_record.get('arrange_flag')=='N') {
        	        // Aurora.showMessage('提示','请先安排GPS！');
        	        // ds.clear();
        	        // return;
        	    // }
        	// }
		]]></script>
        <a:dataSets>
            <a:dataSet id="ast_car_gps_result_ds" model="ast.AST506.ast_car_gps" selectable="true">
                <a:fields>
                    <a:field name="enabled_flag" checkedValue="Y" uncheckedValue="N"/>
                    <a:field name="arrange_flag" checkedValue="Y" uncheckedValue="N"/>
                    <a:field name="install_date" required="true"/>
                    <a:field name="imei"/>
                    <a:field name="install_location"/>
                    <a:field name="gps_provider_desc" lovHeight="500" lovService="ast.AST506.hls_bp_master_lov" lovWidth="600">
                        <a:mapping>
                            <a:map from="bp_id" to="gps_provider"/>
                            <a:map from="bp_name" to="gps_provider_desc"/>
                        </a:mapping>
                    </a:field>
                </a:fields>
                <a:events>
                    <!--                     <a:event name="add" handler="addHandler"/>
 -->
                    <a:event name="submitsuccess" handler="submitsuccessHandler"/>
                </a:events>
            </a:dataSet>
        </a:dataSets>
        <a:grid id="ast_car_gps_grid_id" bindTarget="ast_car_gps_result_ds" height="190" marginWidth="40" navBar="true">
            <a:toolBar>
                <a:button id="gps_add_btn" type="add"/>
                <a:button id="gps_clear_btn" type="clear"/>
            </a:toolBar>
            <a:columns>
                <a:column name="install_date" editor="ast_car_gps_dp" prompt="GPS安装时间" renderer="Aurora.formatDate" width="80"/>
                <a:column name="gps_provider_desc" editor="ast_car_gps_lv" prompt="GPS供应商" width="200"/>
                <a:column name="install_address" editor="ast_car_gps_tf" prompt="安装地址" width="150"/>
                <a:column name="imei" editor="ast_car_gps_tf" prompt="设备号" width="120"/>
                <a:column name="install_location" editor="ast_car_gps_tf" prompt="安装位置" width="150"/>
                <a:column name="gps_fee" align="right" editor="ast_car_gps_nf" prompt="GPS支出" renderer="Aurora.formatMoney" width="80"/>
                <!-- <a:column name="procurement_price" align="right" editor="ast_car_gps_nf" prompt="采购价格" renderer="Aurora.formatMoney" width="80"/> -->
                <a:column name="remove_date" editor="ast_car_gps_dp" prompt="拆除时间" renderer="Aurora.formatDate" width="80"/>
                <!--  <a:column name="financial_manager_name" editor="ast_car_gps_tf" prompt="联系人" width="80"/>
                <a:column name="owner_user_tel" editor="ast_car_gps_tf" prompt="联系方式" width="120"/> -->
                <a:column name="description" editor="ast_car_gps_tf" prompt="备注" width="150"/>
                <!-- <a:column name="arrange_flag" editor="ast_car_gps_cb" prompt="是否安排" width="100"/> -->
                <a:column name="enabled_flag" editor="ast_car_gps_cb" prompt="启用" width="50"/>
                <a:column align="center" prompt="附件上传" renderer="receipt_attachment_upload" width="80"/>
                <!-- <a:column name="install_fee" align="right" editor="ast_car_gps_nf" prompt="安装杂费" renderer="Aurora.formatMoney" width="80"/>
                <a:column name="gps_fee" align="right" editor="ast_car_gps_nf" prompt="GPS年费" renderer="Aurora.formatMoney" width="80"/>
                <a:column name="remove_date" editor="ast_car_gps_dp" prompt="拆除时间" renderer="Aurora.formatDate" width="80"/>
                <a:column name="gps_fee_back" align="right" editor="ast_car_gps_nf" prompt="GPS费用退还" renderer="Aurora.formatMoney" width="80"/>
                <a:column name="description" editor="ast_car_gps_tf" prompt="备注" width="150"/>
                <a:column name="enabled_flag" editor="ast_car_gps_cb" prompt="启用" width="50"/> -->
            </a:columns>
            <a:editors>
                <a:numberField id="ast_car_gps_nf"/>
                <a:textField id="ast_car_gps_tf"/>
                <a:datePicker id="ast_car_gps_dp"/>
                <a:checkBox id="ast_car_gps_cb"/>
                <a:lov id="ast_car_gps_lv"/>
            </a:editors>
        </a:grid>
        <a:hBox/>
    </a:view>
</a:screen>
