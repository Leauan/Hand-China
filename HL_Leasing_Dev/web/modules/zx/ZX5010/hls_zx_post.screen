<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: xuls  
    $Date: 2016-11-24 上午9:18:19  
    $Revision: 1.0  
    $Purpose: 
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application" customizationEnabled="true" dynamiccreateenabled="true">
    <a:init-procedure/>
    <a:view>
        <a:link id="zx5010_create_zx_interface_link" model="zx.ZX5010.create_zx_file" modelaction="execute"/>
        <a:link id="zx5010_create_file_link" url="${/request/@context_path}/modules/zx/ZX5010/hls_zx_post_write.svc"/>
        <a:link id="zx5010_file_down_link" url="${/request/@context_path}/modules/zx/ZX5010/hls_zx_post_download.svc"/>
        <script><![CDATA[
			window['${/parameter/@layout_code}_user_button1_layout_dynamic_click'] = function() {
			    var detail_mask = Ext.getBody();
			    var ds_id = get_dsid_by_basetable(window['${/parameter/@layout_code}_layoutDataSetList'], 'hls_zx_post');
                Aurora.showConfirm('${l:HLS.PROMPT}', '是否确定生成新的征信数据？', function() {
                    Aurora.Masker.mask(detail_mask, '${l:HLS.EXECUTING}');
                    Aurora.request({
                        url: $('zx5010_create_zx_interface_link').getUrl(),
                        para: {},
                        success: function() {
                            Aurora.SideBar.show({
                                msg: '操作成功',
                                duration: 2000
                            });
                            Aurora.Masker.unmask(detail_mask);
                            $(ds_id).query();
                        },
                        failure: function() {
                            Aurora.Masker.unmask(detail_mask);
                        },
                        error: function() {
                            Aurora.Masker.unmask(detail_mask);
                        },
                        scope: this
                    });
                });
            };
            window['${/parameter/@layout_code}_user_button2_layout_dynamic_click'] = function() {
			    var detail_mask = Ext.getBody();
			    var ds_id = get_dsid_by_basetable(window['${/parameter/@layout_code}_layoutDataSetList'], 'hls_zx_post');
			    var rs = $(ds_id).getSelected();
                if (rs.length != 1) {
                    Aurora.showMessage('${l:PROMPT}', '${l:HLS.SELECT_RECORD}');
                    return;
                }
                Aurora.showConfirm('${l:HLS.PROMPT}', '是否确定生成征信接口文件？', function() {
                     Aurora.Masker.mask(detail_mask, '${l:HLS.EXECUTING}');
                    Aurora.request({
                        url: $('zx5010_create_file_link').getUrl(),
                        para: {post_id:rs[0].get('post_id')},
                        success: function() {
                            Aurora.SideBar.show({
                                msg: '操作成功',
                                duration: 2000
                            });
                            Aurora.Masker.unmask(detail_mask);
                            $(ds_id).query();
                        },
                        failure: function() {
                            Aurora.Masker.unmask(detail_mask);
                        },
                        error: function() {
                            Aurora.Masker.unmask(detail_mask);
                        },
                        scope: this
                    });
                });
            };
            window['${/parameter/@layout_code}_user_button3_layout_dynamic_click'] = function() {
			    var detail_mask = Ext.getBody();
			    var ds_id = get_dsid_by_basetable(window['${/parameter/@layout_code}_layoutDataSetList'], 'hls_zx_post');
			    var rs = $(ds_id).getSelected();
                if (rs.length != 1) {
                    Aurora.showMessage('${l:PROMPT}', '${l:HLS.SELECT_RECORD}');
                    return;
                }
                Aurora.showConfirm('${l:HLS.PROMPT}', '是否确定下载征信接口文件？', function() {
                  var url_l = $('zx5010_file_down_link').getUrl() + '?file_name=' + rs[0].get('file_name') + '&file_path=' + rs[0].get('file_path');
                  window.open(href = url_l, target = "_self");
                });
            };
]]></script>
        <a:screen-include screen="modules/cont/CON500/con_contract_get_layout_code.screen"/>
    </a:view>
</a:screen>
