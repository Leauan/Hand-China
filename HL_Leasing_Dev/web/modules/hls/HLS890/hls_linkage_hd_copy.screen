<?xml version="1.0" encoding="UTF-8"?>
<a:screen xmlns:a="http://www.aurora-framework.org/application" customizationEnabled="true" dynamiccreateenabled="true" trace="true">
    <a:view>
        <a:link id="copy_linkage_hd_link" model="hls.HLS891.copy_linkage_hd" modelaction="batch_update"/>
        <script><![CDATA[
             window['${/parameter/@layout_code}_user_button3_layout_dynamic_click'] = function() {
                 window['${/parameter/@layout_code}_unlock_layout_dynamic_window']();
                 var ds_id = get_dsid_by_basetable(window['${/parameter/@layout_code}_layoutDataSetList'], 'hls_bp_master');
                 var records = $(ds_id).getSelected();
                 var from_bp_id='${/parameter/@bp_id}';
                 var param = [];
                 for (var i = 0;i < records.length;i++) {
                     var record = records[i];
                     var bp_id = record.get('bp_id');
                     param.push({
                         'from_bp_id': from_bp_id,
                         'to_bp_id': bp_id,
                         '_status': 'update'
                     });
                 } 
                 Aurora.request({
                     url: $('copy_linkage_hd_link').getUrl(),
                     para: param,
                     success: function(res) {
                        Aurora.SideBar.show({
                            msg: '复制成功',
                            duration: 2000
                        });
                         window['${/parameter/@layout_code}_unlock_layout_dynamic_window']();
                         $('${/parameter/@winId}').close();
                     },
                     failure: function() {
                         window['${/parameter/@layout_code}_unlock_layout_dynamic_window']();
                     },
                     error: function() {
                         window['${/parameter/@layout_code}_unlock_layout_dynamic_window']();
                     },
                     scope: this
                 });
             
             };
         ]]></script>
    </a:view>
</a:screen>
