<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: zhuxianfei
    $Date: 2017年11月23日 下午1:34:27  
    $Revision: 1.0  
    $Purpose: 
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application" trace="true">
    <a:init-procedure/>
    <a:view>
        <script><![CDATA[
         //集团的话查询出所有旗下单店的信息
            Aurora.onReady(function() {
                var parent_flag = '${/parameter/@parent_flag}';
                if (parent_flag == 'Y') {
                    var url = "${/request/@context_path}/autocrud/hls.HLS700.hls_parent_bp_credit_useinfo/query?bp_id=${/parameter/@bp_id}";
                    $('hls700_credit_useinfo_result_ds').setQueryUrl(url);
            
                }
            });
            function credit_detail_exit() {
                $('bp_credit_details_window').close();
            }
        ]]></script>
        <a:dataSets>
            <a:dataSet id="hls700_credit_detail_query_ds"/>
            <a:dataSet id="enable_flag_ds" lookupCode="HLS700_ENABLED_FLAG"/>
            <a:dataSet id="hls700_credit_detail_result_ds" autoPageSize="true" autoQuery="true" fetchAll="true" model="hls.HLS700.hls_bp_master_credit_detail" queryUrl="${/request/@context_path}/autocrud/hls.HLS700.hls_bp_master_credit_detail/query?bp_id=${/parameter/@bp_id}" selectable="true" selectionModel="single">
                <a:fields>
                    <a:field name="bp_name" defaultValue="${/parameter/@bp_name}" readOnly="true"/>
                    <a:field name="credit_total_amount" required="true"/>
                    <a:field name="open_amount"/>
                    <a:field name="credit_date_from" required="true"/>
                    <a:field name="credit_date_to" required="true"/>
                    <a:field name="enable_flag" defaultValue="Y" required="true"/>
                    <a:field name="enable_flag_desc" defaultValue="生效" displayField="code_value_name" options="enable_flag_ds" required="true" returnField="enable_flag" valueField="code_value"/>
                </a:fields>
            </a:dataSet>
            <a:dataSet id="hls700_credit_useinfo_result_ds" autoPageSize="true" autoQuery="true" queryUrl="${/request/@context_path}/autocrud/hls.HLS700.hls_bp_master_credit_useinfo/query?bp_id=${/parameter/@bp_id}" selectable="true" selectionModel="single"/>
            <a:dataSet id="hls700_credit_used_detail_result_ds" autoPageSize="true" autoQuery="true" model="hls.HLS700.hls_bp_master_credit_detail"/>
        </a:dataSets>
        <a:screenBody>
            <a:screenTopToolbar>
                <a:screenTitle/>
                <a:gridButton click="credit_detail_exit" text="HLS.EXIT"/>
            </a:screenTopToolbar>
            <a:tabPanel marginHeight="200" marginWidth="30">
                <a:tabs>
                    <a:tab prompt="额度明细" width="110">
                        <a:grid id="hls700_credit_detail_grid_ds" bindTarget="hls700_credit_detail_result_ds" marginHeight="230" marginWidth="60" navBar="true">
                            <a:columns>
                                <a:column name="bp_name" prompt="商业伙伴名称" width="280"/>
                                <a:column name="credit_total_amount" align="right" prompt="授信总额度" renderer="Aurora.formatMoney" width="180"/>
                                <a:column name="credit_date_from" align="center" prompt="授信期限从" renderer="Aurora.formatDate" width="150"/>
                                <a:column name="credit_date_to" align="center" prompt="授信期限到" renderer="Aurora.formatDate" width="150"/>
                                <a:column name="enable_flag_desc" prompt="额度状态"/>
                            </a:columns>
                        </a:grid>
                    </a:tab>
                    <a:tab prompt="额度使用详情" width="110">
                        <a:grid id="hls700_credit_detail_grid_ds_02" bindTarget="hls700_credit_useinfo_result_ds" marginHeight="230" marginWidth="60" navBar="true">
                            <a:columns>
                                <a:column name="project_number" align="center" prompt="库融申请编号" width="150"/>
                                <a:column name="business_type_n" align="center" prompt="业务类型" width="120"/>
                                <a:column name="bp_name" align="center" prompt="经销商名称" width="280"/>
                                <a:column name="project_status_n" align="center" prompt="库融申请状态" width="120"/>
                                <a:column name="finance_amount" align="right" prompt="投放额度" renderer="Aurora.formatMoney" width="150"/>
                                <a:column name="rp_amount" align="right" prompt="释放额度" renderer="Aurora.formatMoney" width="150"/>
                                <a:column name="rm_amount" align="right" prompt="占用额度" renderer="Aurora.formatMoney" width="150"/>
                            </a:columns>
                        </a:grid>
                    </a:tab>
                </a:tabs>
            </a:tabPanel>
        </a:screenBody>
    </a:view>
</a:screen>
