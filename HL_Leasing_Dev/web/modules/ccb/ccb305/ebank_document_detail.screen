<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: xuls  
    $Date: 2017-2-10 上午10:02:14  
    $Revision: 1.0  
    $Purpose: 
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application" customizationEnabled="true" dynamiccreateenabled="true">
    <a:init-procedure/>
    <a:view>
        <a:link id="ccb305_reverse_document_link" model="ccb.ccb305.reverse_document" modelaction="batch_update"/>
        <script><![CDATA[
    window['${/parameter/@layout_code}_user_button1_layout_dynamic_click'] = function() {
        var param = {};
        var saveData = [];
        var ds_id = get_dsid_by_basetable(window['${/parameter/@layout_code}_layoutDataSetList'], 'hls_ebank_ccb_document');
        var document_ds = $(ds_id);
        var records = document_ds.getSelected();
        if (records.length == 0) {
            Aurora.showMessage('${l:PROMPT}', '请选择需要反冲的代扣单');
            return;
        }
        Aurora.showConfirm('${l:PROMPT}', '是否确定反冲？', function() {
            var detail_mask = Ext.getBody();
            Aurora.Masker.mask(detail_mask, '${l:HLS.EXECUTING}');
            for (var i = 0;i < records.length;i++) {
                var record = records[i];
                saveData.push({
                    'document_id': record.get('document_id'),
                    '_status': 'update'
                });
            }
            Aurora.request({
                url: $('ccb305_reverse_document_link').getUrl(),
                para: saveData,
                success: function() {
                    Aurora.SideBar.show({
                        msg: '${l:HLS.SUBMIT_SUCCESS}',
                        duration: 2000
                    });
                    document_ds.query(document_ds.currentPage);
                    Aurora.Masker.unmask(detail_mask);
                },
                failure: function() {
                    Aurora.Masker.unmask(detail_mask);
                },
                error: function() {
                    Aurora.Masker.unmask(detail_mask);
                },
                scope: this
            });
        });
    
    };
]]></script>
        <a:screen-include screen="modules/cont/CON500/con_contract_get_layout_code.screen"/>
    </a:view>
</a:screen>
