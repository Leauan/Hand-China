<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: qianming  
    $Date: 2016-3-16 下午7:28:04  
    $Revision: 1.0  
    $Purpose: 
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application">
    <a:init-procedure/>
    <a:view>
        <a:link id="rd_project_analyse_detail_link_id" url="${/request/@context_path}/modules/prj/PRJ501N/prj_analyse_detail.screen"/>
        <a:link id="${/parameter/@layout_code}${/parameter/@pre_layout}prj501n_analyse_detail_link" url="${/request/@context_path}/modules/prj/PRJ501N/prj_analyse_detail.screen"/>
        <script><![CDATA[
            function do_query() {
                $('rd_project_analyse_total_v_result_ds').query();
            }
            
            function do_reset() {
                $('rd_project_analyse_total_v_query_ds').reset();
            }
            
            /* function do_open_detailes(target_type, target, condition_code) {
             Aurora.Window({
             id: 'rd_project_analyse_detail_win_id',
             url: $('rd_project_analyse_detail_link_id').getUrl(),
             params: {
             target_type: target_type,
             target: target,
             condition_code: condition_code
             },
             fullScreen: true
             });
             } */
            
            function do_open_detailes(record_id, ds_id, condition_code) {
                var record = $('rd_project_analyse_total_v_result_ds').findById(record_id);
                var param = {};
                param['target_type'] = record.get('target_type');
                param['target'] = record.get('target');
                param['condition_code'] = condition_code;
                param['layout_code'] = 'PRJ_ANALYSE_DETAIL';
                param['winid'] = 'prj501n_analyse_detail_win';
                param['function_usage'] = 'QUERY';
                var win = new Aurora.Window({
                    id: 'prj501n_analyse_detail_win',
                    params: param,
                    url: $('${/parameter/@layout_code}${/parameter/@pre_layout}prj501n_analyse_detail_link').getUrl(),
                    title: '维度明细(' + 'PRJ_ANALYSE_DETAIL)',
                    fullScreen: true,
                    draggable: true
                });
            }
            
            function do_render(value, record, name) {
                
                var condition_code;
                if (name === 'approved_count') {
                    condition_code = '11';
                } else if (name === 'reject_count') {
                    condition_code = '12';
                } else if (name === 'cancel_count') {
                    condition_code = '13';
                } else if (name === 'terminate_count') {
                    condition_code = '14';
                }
                if (value > 0) {
                    return '<a href="javascript:do_open_detailes(\'' + record.id + '\',\'' + record.id + '\',\'' + condition_code + '\')">' + value + '</a>';
                } else {
                    return value;
                }
            }
        ]]></script>
        <a:dataSets>
            <a:dataSet id="target_type_ds">
                <a:datas>
                    <a:record code="PHONE" value="手机号"/>
                    <a:record code="ID_CARD" value="身份证号"/>
                    <!--  <a:record code="VIN" value="VIN码"/> -->
                   <!--     <a:record code="item_frame_number" value="车架号"/> -->
                </a:datas>
            </a:dataSet>
            <a:dataSet id="rd_project_analyse_total_v_query_ds" autoCreate="true">
                <a:fields>
                    <a:field name="target_type_name" displayField="value" options="target_type_ds" returnField="target_type" valueField="code"/>
                </a:fields>
            </a:dataSet>
            <a:dataSet id="rd_project_analyse_total_v_result_ds" autoPageSize="true" autoQuery="true" model="prj.PRJ330.hls_analyse_by_project_lv" queryDataSet="rd_project_analyse_total_v_query_ds"/>
        </a:dataSets>
        <a:screenBody>
            <a:screenTopToolbar>
                <a:screenTitle/>
                <a:gridButton click="do_query" text="HLS.QUERY"/>
                <a:gridButton click="do_reset" text="HLS.RESET"/>
            </a:screenTopToolbar>
            <a:form column="4" labelWidth="110" marginWidth="35" title="HLS.QUERY_TITLE">
                <a:comboBox name="target_type_name" bindTarget="rd_project_analyse_total_v_query_ds" prompt="维度"/>
                <a:textField name="target" bindTarget="rd_project_analyse_total_v_query_ds" prompt="目标码"/>
            </a:form>
            <a:grid id="rd_project_analyse_total_grid_id" bindTarget="rd_project_analyse_total_v_result_ds" marginHeight="160" marginWidth="35" navBar="true" showRowNumber="true">
                <a:columns>
                    <a:column name="target_type_name" align="center" lock="true" prompt="维度" width="140"/>
                    <a:column name="target" lock="true" prompt="目标码" width="200"/>
                    <a:column name="target_name" prompt="名称" width="150"/>
                    <a:column name="approved_count" prompt="业务审批通过数" renderer="do_render"/>
                    <a:column name="reject_count" prompt="业务审批拒绝数" renderer="do_render"/>
                    <a:column name="cancel_count" prompt="合同终止数" renderer="do_render"/>
                    <a:column name="terminate_count" prompt="已结清数" renderer="do_render"/>
                </a:columns>
            </a:grid>
        </a:screenBody>
    </a:view>
</a:screen>
