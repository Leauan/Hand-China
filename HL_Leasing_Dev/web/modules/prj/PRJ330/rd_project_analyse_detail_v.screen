<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: qianming  
    $Date: 2016-3-16 下午8:00:10  
    $Revision: 1.0  
    $Purpose: 
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application">
    <a:init-procedure/>
    <a:view>
        <a:link id="wfl_prj_project_get_layout_code_link_id" model="cont.CON500.con_contract_get_layout_code" modelaction="update"/>
        <a:link id="wfl_readonly_pageLink_projectQueryScreen_update_project" url="${/request/@context_path}/modules/prj/PRJ501N/prj_project_maintain.screen"/>
        <a:link id="wfl_readonly_pageLink_contractQueryScreen_update_contract" url="${/request/@context_path}/modules/cont/CON501N/con_contract_modify_query.screen"/>
        <script><![CDATA[
            function wfl_prj501_project_number_render(value, record, name) {
                return '<a href="javascript:wfl_prj501_grid_update(' + record.get('project_id') + ');">' + value + '</a>';
            }
            
            function wfl_prj501_grid_update(project_id) {
                var param = $('rd_project_analyse_detail_v_result_ds').getCurrentRecord().data;
                param['document_id'] = record.get('project_id');
                param['function_code'] = 'PRJ501W';
                param['function_usage'] = 'QUERY';
                param['url_title'] = '租赁申请查询';
                hls_doc_get_layout_code('wfl_prj_project_get_layout_code_link_id', param, 'wfl_readonly_pageLink_projectQueryScreen_update_project');
            }
            
            
            function wfl_con501_contract_number_render(value, record, name) {
                if (value) {
                    return '<a href="javascript:wfl_con501_grid_update(' + record.get('contract_id') + ');">' + value + '</a>';
                }
            }
            
            function wfl_con501_grid_update(contract_id) {
                //alert(contract_id);
                var param = $('rd_project_analyse_detail_v_result_ds').getCurrentRecord().data;
                param['document_id'] = record.get('contract_id');
                param['function_code'] = 'CON501E';
                param['function_usage'] = 'QUERY';
                param['url_title'] = '合同查询';
                hls_doc_get_layout_code('wfl_prj_project_get_layout_code_link_id', param, 'wfl_readonly_pageLink_contractQueryScreen_update_contract');
            }
        ]]></script>
        <a:screen-include screen="modules/prj/PRJ500/prj_project_get_layout_code.screen"/>
        <a:dataSets>
            <a:dataSet id="rd_project_analyse_detail_v_result_ds" autoQuery="true" fetchAll="true" queryUrl="${/request/@context_path}/autocrud/prj.PRJ330.rd_project_analyse_detail_v/query?target_type=${/parameter/@target_type}&amp;target=${/parameter/@target}&amp;project_id=${/parameter/@project_id}&amp;condition_code=${/parameter/@condition_code}"/>
        </a:dataSets>
        <a:screenBody>
            <a:grid id="rd_project_analyse_detail_grid_id" bindTarget="rd_project_analyse_detail_v_result_ds" marginHeight="100" marginWidth="35" navBar="true" showRowNumber="true">
                <a:toolBar>
                    <a:button type="excel"/>
                </a:toolBar>
                <a:columns>
                    <a:column name="target_type_desc" lock="true" prompt="维度" width="130"/>
                    <a:column name="target" lock="true" prompt="目标码" width="200"/>
                    <a:column name="current_users" lock="true" prompt="当前使用人" width="200"/>
                    <a:column name="project_number" prompt="项目编号" renderer="wfl_prj501_project_number_render" width="140"/>
                    <a:column name="contract_number" prompt="合同编号" renderer="wfl_con501_contract_number_render" width="140"/>
                    <!-- <a:column name="contract_id" prompt="合同ID" width="140"/> -->
                    <a:column name="project_status_n" prompt="项目状态" width="120"/>
                    <a:column name="bp_category_n" prompt="使用人类型" width="100"/>
                    <a:column name="bp_name" prompt="使用人" width="100"/>
                    <a:column name="id_card_no" prompt="使用人身份证" width="200"/>
                    <a:column name="cell_phone" prompt="使用人手机号" width="140"/>
                </a:columns>
            </a:grid>
        </a:screenBody>
    </a:view>
</a:screen>
